--- astro.config.mjs

import { defineConfig } from "astro/config";
import tailwind from "@astrojs/tailwind";
import react from "@astrojs/react";
import netlify from "@astrojs/netlify";

// https://astro.build/config
export default defineConfig({
  integrations: [
    tailwind({
      applyBaseStyles: true,
      nesting: true,
    }),
    react(),
  ],
  output: "server",
  adapter: netlify(),
  vite: {
    css: {
      devSourcemap: true,
    },
  },
});


--- postcss.config.cjs

module.exports = {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
};


--- README.md

# Astro Starter Kit: Minimal

```sh
pnpm create astro@latest -- --template minimal
```

> 🧑‍🚀 **Seasoned astronaut?** Delete this file. Have fun!

## 🚀 Project Structure

Inside of your Astro project, you'll see the following folders and files:

```text
/
├── public/
├── src/
│   └── pages/
│       └── index.astro
└── package.json
```

Astro looks for `.astro` or `.md` files in the `src/pages/` directory. Each page is exposed as a route based on its file name.

There's nothing special about `src/components/`, but that's where we like to put any Astro/React/Vue/Svelte/Preact components.

Any static assets, like images, can be placed in the `public/` directory.

## 🧞 Commands

All commands are run from the root of the project, from a terminal:

| Command                   | Action                                           |
| :------------------------ | :----------------------------------------------- |
| `pnpm install`             | Installs dependencies                            |
| `pnpm dev`             | Starts local dev server at `localhost:4321`      |
| `pnpm build`           | Build your production site to `./dist/`          |
| `pnpm preview`         | Preview your build locally, before deploying     |
| `pnpm astro ...`       | Run CLI commands like `astro add`, `astro check` |
| `pnpm astro -- --help` | Get help using the Astro CLI                     |

## 👀 Want to learn more?

Feel free to check [our documentation](https://docs.astro.build) or jump into our [Discord server](https://astro.build/chat).


--- tailwind.config.mjs

/** @type {import('tailwindcss').Config} */
export default {
  darkMode: 'class',
  content: [
    './src/**/*.{astro,html,js,jsx,md,mdx,svelte,ts,tsx,vue}',
    './public/**/*.html',
  ],
  safelist: [
    'hidden',
    'dark',
    'bg-background',
    'text-foreground',
    'bg-card',
    'text-card-foreground',
    'border-border',
    'font-playfair',
    'font-doto',
    'font-inter',
    'font-pacifico',
    'font-great-vibes',
  ],
  theme: {
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
      },
      fontFamily: {
        playfair: ['"Playfair Display"', 'serif'],
        inter: ['Inter', 'system-ui', 'sans-serif'],
        doto: ['"Doto"', 'sans-serif'],
        pacifico: ['Pacifico', 'cursive'],
        'great-vibes': ['"Great Vibes"', 'cursive'],
      },
    },
  },
  plugins: [],
};


--- tsconfig.json

{
  "extends": "astro/tsconfigs/strict",
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist"]
}


--- .astro\content-assets.mjs

export default new Map();

--- .astro\content-modules.mjs

export default new Map();

--- .astro\content.d.ts

declare module 'astro:content' {
	export interface RenderResult {
		Content: import('astro/runtime/server/index.js').AstroComponentFactory;
		headings: import('astro').MarkdownHeading[];
		remarkPluginFrontmatter: Record<string, any>;
	}
	interface Render {
		'.md': Promise<RenderResult>;
	}

	export interface RenderedContent {
		html: string;
		metadata?: {
			imagePaths: Array<string>;
			[key: string]: unknown;
		};
	}
}

declare module 'astro:content' {
	type Flatten<T> = T extends { [K: string]: infer U } ? U : never;

	export type CollectionKey = keyof AnyEntryMap;
	export type CollectionEntry<C extends CollectionKey> = Flatten<AnyEntryMap[C]>;

	export type ContentCollectionKey = keyof ContentEntryMap;
	export type DataCollectionKey = keyof DataEntryMap;

	type AllValuesOf<T> = T extends any ? T[keyof T] : never;
	type ValidContentEntrySlug<C extends keyof ContentEntryMap> = AllValuesOf<
		ContentEntryMap[C]
	>['slug'];

	export type ReferenceDataEntry<
		C extends CollectionKey,
		E extends keyof DataEntryMap[C] = string,
	> = {
		collection: C;
		id: E;
	};
	export type ReferenceContentEntry<
		C extends keyof ContentEntryMap,
		E extends ValidContentEntrySlug<C> | (string & {}) = string,
	> = {
		collection: C;
		slug: E;
	};
	export type ReferenceLiveEntry<C extends keyof LiveContentConfig['collections']> = {
		collection: C;
		id: string;
	};

	/** @deprecated Use `getEntry` instead. */
	export function getEntryBySlug<
		C extends keyof ContentEntryMap,
		E extends ValidContentEntrySlug<C> | (string & {}),
	>(
		collection: C,
		// Note that this has to accept a regular string too, for SSR
		entrySlug: E,
	): E extends ValidContentEntrySlug<C>
		? Promise<CollectionEntry<C>>
		: Promise<CollectionEntry<C> | undefined>;

	/** @deprecated Use `getEntry` instead. */
	export function getDataEntryById<C extends keyof DataEntryMap, E extends keyof DataEntryMap[C]>(
		collection: C,
		entryId: E,
	): Promise<CollectionEntry<C>>;

	export function getCollection<C extends keyof AnyEntryMap, E extends CollectionEntry<C>>(
		collection: C,
		filter?: (entry: CollectionEntry<C>) => entry is E,
	): Promise<E[]>;
	export function getCollection<C extends keyof AnyEntryMap>(
		collection: C,
		filter?: (entry: CollectionEntry<C>) => unknown,
	): Promise<CollectionEntry<C>[]>;

	export function getLiveCollection<C extends keyof LiveContentConfig['collections']>(
		collection: C,
		filter?: LiveLoaderCollectionFilterType<C>,
	): Promise<
		import('astro').LiveDataCollectionResult<LiveLoaderDataType<C>, LiveLoaderErrorType<C>>
	>;

	export function getEntry<
		C extends keyof ContentEntryMap,
		E extends ValidContentEntrySlug<C> | (string & {}),
	>(
		entry: ReferenceContentEntry<C, E>,
	): E extends ValidContentEntrySlug<C>
		? Promise<CollectionEntry<C>>
		: Promise<CollectionEntry<C> | undefined>;
	export function getEntry<
		C extends keyof DataEntryMap,
		E extends keyof DataEntryMap[C] | (string & {}),
	>(
		entry: ReferenceDataEntry<C, E>,
	): E extends keyof DataEntryMap[C]
		? Promise<DataEntryMap[C][E]>
		: Promise<CollectionEntry<C> | undefined>;
	export function getEntry<
		C extends keyof ContentEntryMap,
		E extends ValidContentEntrySlug<C> | (string & {}),
	>(
		collection: C,
		slug: E,
	): E extends ValidContentEntrySlug<C>
		? Promise<CollectionEntry<C>>
		: Promise<CollectionEntry<C> | undefined>;
	export function getEntry<
		C extends keyof DataEntryMap,
		E extends keyof DataEntryMap[C] | (string & {}),
	>(
		collection: C,
		id: E,
	): E extends keyof DataEntryMap[C]
		? string extends keyof DataEntryMap[C]
			? Promise<DataEntryMap[C][E]> | undefined
			: Promise<DataEntryMap[C][E]>
		: Promise<CollectionEntry<C> | undefined>;
	export function getLiveEntry<C extends keyof LiveContentConfig['collections']>(
		collection: C,
		filter: string | LiveLoaderEntryFilterType<C>,
	): Promise<import('astro').LiveDataEntryResult<LiveLoaderDataType<C>, LiveLoaderErrorType<C>>>;

	/** Resolve an array of entry references from the same collection */
	export function getEntries<C extends keyof ContentEntryMap>(
		entries: ReferenceContentEntry<C, ValidContentEntrySlug<C>>[],
	): Promise<CollectionEntry<C>[]>;
	export function getEntries<C extends keyof DataEntryMap>(
		entries: ReferenceDataEntry<C, keyof DataEntryMap[C]>[],
	): Promise<CollectionEntry<C>[]>;

	export function render<C extends keyof AnyEntryMap>(
		entry: AnyEntryMap[C][string],
	): Promise<RenderResult>;

	export function reference<C extends keyof AnyEntryMap>(
		collection: C,
	): import('astro/zod').ZodEffects<
		import('astro/zod').ZodString,
		C extends keyof ContentEntryMap
			? ReferenceContentEntry<C, ValidContentEntrySlug<C>>
			: ReferenceDataEntry<C, keyof DataEntryMap[C]>
	>;
	// Allow generic `string` to avoid excessive type errors in the config
	// if `dev` is not running to update as you edit.
	// Invalid collection names will be caught at build time.
	export function reference<C extends string>(
		collection: C,
	): import('astro/zod').ZodEffects<import('astro/zod').ZodString, never>;

	type ReturnTypeOrOriginal<T> = T extends (...args: any[]) => infer R ? R : T;
	type InferEntrySchema<C extends keyof AnyEntryMap> = import('astro/zod').infer<
		ReturnTypeOrOriginal<Required<ContentConfig['collections'][C]>['schema']>
	>;

	type ContentEntryMap = {

	};

	type DataEntryMap = {

	};

	type AnyEntryMap = ContentEntryMap & DataEntryMap;

	type ExtractLoaderTypes<T> = T extends import('astro/loaders').LiveLoader<
		infer TData,
		infer TEntryFilter,
		infer TCollectionFilter,
		infer TError
	>
		? { data: TData; entryFilter: TEntryFilter; collectionFilter: TCollectionFilter; error: TError }
		: { data: never; entryFilter: never; collectionFilter: never; error: never };
	type ExtractDataType<T> = ExtractLoaderTypes<T>['data'];
	type ExtractEntryFilterType<T> = ExtractLoaderTypes<T>['entryFilter'];
	type ExtractCollectionFilterType<T> = ExtractLoaderTypes<T>['collectionFilter'];
	type ExtractErrorType<T> = ExtractLoaderTypes<T>['error'];

	type LiveLoaderDataType<C extends keyof LiveContentConfig['collections']> =
		LiveContentConfig['collections'][C]['schema'] extends undefined
			? ExtractDataType<LiveContentConfig['collections'][C]['loader']>
			: import('astro/zod').infer<
					Exclude<LiveContentConfig['collections'][C]['schema'], undefined>
				>;
	type LiveLoaderEntryFilterType<C extends keyof LiveContentConfig['collections']> =
		ExtractEntryFilterType<LiveContentConfig['collections'][C]['loader']>;
	type LiveLoaderCollectionFilterType<C extends keyof LiveContentConfig['collections']> =
		ExtractCollectionFilterType<LiveContentConfig['collections'][C]['loader']>;
	type LiveLoaderErrorType<C extends keyof LiveContentConfig['collections']> = ExtractErrorType<
		LiveContentConfig['collections'][C]['loader']
	>;

	export type ContentConfig = typeof import("./../src/content.config.mjs");
	export type LiveContentConfig = never;
}


--- .astro\data-store.json

[["Map",1,2],"meta::meta",["Map",3,4,5,6],"astro-version","5.16.5","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"server\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":false,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\",\"entrypoint\":\"astro/assets/endpoint/dev\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false},\"session\":{\"driver\":\"fs-lite\",\"options\":{\"base\":\"C:\\\\Users\\\\Lenovo\\\\Desktop\\\\kowtattys-astro\\\\node_modules\\\\.astro\\\\sessions\"}}}"]

--- .astro\settings.json

{
	"_variables": {
		"lastUpdateCheck": 1765825633006
	}
}

--- .astro\types.d.ts

/// <reference types="astro/client" />


--- src\env.d.ts

/// <reference path="../.astro/types.d.ts" />
/// <reference types="astro/client" />

interface ImportMetaEnv {
  readonly PUBLIC_SUPABASE_URL: string;
  readonly PUBLIC_SUPABASE_ANON_KEY: string;
  readonly SUPABASE_SERVICE_ROLE_KEY: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}

declare namespace App {
  interface Locals {
    user: import("@supabase/supabase-js").User | null;
    session: import("@supabase/supabase-js").Session | null;
  }
}


--- src\middleware.ts

import { defineMiddleware } from "astro:middleware";
import { supabase } from "./lib/supabase";

/**
 * Authentication middleware for admin routes.
 * This runs on every request in SSR mode.
 */
export const onRequest = defineMiddleware(
  async ({ url, redirect, locals, cookies }, next) => {
    // Check if the current request is for an admin page
    const isAdminPath = url.pathname.startsWith("/admin");
    const isLoginPage = url.pathname === "/admin/login";

    // Handle Supabase auth tokens from cookies for SSR
    const accessToken = cookies.get("sb-access-token")?.value;
    const refreshToken = cookies.get("sb-refresh-token")?.value;

    if (accessToken && refreshToken) {
      await supabase.auth.setSession({
        access_token: accessToken,
        refresh_token: refreshToken,
      });
    }

    // If it's an admin route and not the login page, verify authentication
    if (isAdminPath && !isLoginPage) {
      // Check for an active session
      const {
        data: { session },
      } = await supabase.auth.getSession();

      if (!session) {
        // No active session found, redirect to the login page
        return redirect("/admin/login");
      }

      // Pass session/user data to the page through locals if needed
      locals.user = session.user;
      locals.session = session;
    }

    // Proceed to the next middleware or the actual page rendering
    return next();
  },
);


--- src\components\BookingModal.astro

---
// BookingModal.astro - Global booking modal component
---

<dialog id="booking-modal" class="booking-modal">
    <div class="booking-modal-content">
        <!-- Close Button -->
        <button
            id="booking-modal-close"
            class="booking-modal-close"
            aria-label="Close booking modal"
        >
            <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>

        <!-- Initial Choice Step -->
        <div id="booking-choice" class="booking-choice">
            <h2 class="text-2xl font-bold mb-2 font-doto">Book Your Tattoo</h2>
            <p class="text-muted-foreground text-sm mb-6">
                Choose an option to get started
            </p>

            <div class="choice-grid">
                <button id="choice-custom" class="choice-card">
                    <h3 class="text-lg font-semibold mb-2">
                        Request a Custom Tattoo
                    </h3>
                    <p class="text-sm text-muted-foreground">
                        Work with our artists to create a unique design
                    </p>
                </button>

                <button id="choice-flash" class="choice-card">
                    <h3 class="text-lg font-semibold mb-2">
                        Shop Flash Designs
                    </h3>
                    <p class="text-sm text-muted-foreground">
                        Browse our collection of ready-to-ink designs
                    </p>
                </button>
            </div>
        </div>

        <!-- Custom Tattoo Form (Hidden Initially) -->
        <div id="booking-form-container" class="hidden">
            <!-- Progress Indicator -->
            <div class="booking-progress">
                <div class="progress-step active" data-progress="1">1</div>
                <div class="progress-line"></div>
                <div class="progress-step" data-progress="2">2</div>
                <div class="progress-line"></div>
                <div class="progress-step" data-progress="3">3</div>
                <div class="progress-line"></div>
                <div class="progress-step" data-progress="4">4</div>
            </div>

            <h2 class="text-2xl font-bold mb-6 text-center font-doto">
                Booking Request
            </h2>

            <form id="booking-form" class="booking-form">
                <!-- Step 1: Idea -->
                <div class="form-step active" data-step="1">
                    <h3 class="text-xl mb-4 font-doto">
                        What's your tattoo idea?
                    </h3>
                    <p class="text-muted-foreground text-sm mb-4">
                        Tell us about your vision. Be as detailed as you'd like!
                    </p>
                    <textarea
                        name="idea"
                        class="w-full p-4 border rounded-md bg-background text-foreground resize-none"
                        rows="5"
                        placeholder="Describe your dream tattoo..."
                        required></textarea>
                    <div class="flex justify-between mt-6">
                        <button
                            type="button"
                            class="btn-back-to-choice border border-foreground/20 px-6 py-2 rounded hover:bg-muted transition-colors"
                        >
                            <svg
                                class="inline-block w-4 h-4 mr-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                        <button
                            type="button"
                            class="btn-next bg-primary text-primary-foreground px-6 py-2 rounded hover:opacity-90 transition-opacity"
                        >
                            Next
                            <svg
                                class="inline-block w-4 h-4 ml-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Placement & Size -->
                <div class="form-step" data-step="2">
                    <h3 class="text-xl mb-4 font-doto">Placement & Size</h3>
                    <p class="text-muted-foreground text-sm mb-4">
                        Where would you like your tattoo and how big?
                    </p>
                    <div class="grid gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2"
                                >Placement</label
                            >
                            <input
                                type="text"
                                name="placement"
                                placeholder="e.g., Forearm, Shoulder, Back"
                                class="w-full p-3 border rounded bg-background text-foreground"
                                required
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2"
                                >Size</label
                            >
                            <select
                                name="size"
                                class="w-full p-3 border rounded bg-background text-foreground"
                                required
                            >
                                <option value="">Select Size</option>
                                <option value="1-2 inches"
                                    >1-2 inches (Small)</option
                                >
                                <option value="3-5 inches"
                                    >3-5 inches (Medium)</option
                                >
                                <option value="6+ inches"
                                    >6+ inches (Large)</option
                                >
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button
                            type="button"
                            class="btn-prev border border-foreground/20 px-6 py-2 rounded hover:bg-muted transition-colors"
                        >
                            <svg
                                class="inline-block w-4 h-4 mr-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                        <button
                            type="button"
                            class="btn-next bg-primary text-primary-foreground px-6 py-2 rounded hover:opacity-90 transition-opacity"
                        >
                            Next
                            <svg
                                class="inline-block w-4 h-4 ml-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Reference Photos -->
                <div class="form-step" data-step="3">
                    <h3 class="text-xl mb-4 font-doto">Reference Photos</h3>
                    <p class="text-muted-foreground text-sm mb-4">
                        Upload any inspiration images (optional but helpful!)
                    </p>
                    <div class="upload-area">
                        <input
                            type="file"
                            id="ref-photos"
                            multiple
                            accept="image/*"
                            class="hidden"
                        />
                        <label for="ref-photos" class="upload-label">
                            <svg
                                class="w-12 h-12 mx-auto mb-3 text-muted-foreground"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="1.5"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                                ></path>
                            </svg>
                            <span class="text-muted-foreground"
                                >Click to upload or drag and drop</span
                            >
                            <span
                                class="text-xs text-muted-foreground mt-1 block"
                                >PNG, JPG up to 10MB each</span
                            >
                        </label>
                        <div id="file-preview" class="file-preview mt-4"></div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button
                            type="button"
                            class="btn-prev border border-foreground/20 px-6 py-2 rounded hover:bg-muted transition-colors"
                        >
                            <svg
                                class="inline-block w-4 h-4 mr-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                        <button
                            type="button"
                            class="btn-next bg-primary text-primary-foreground px-6 py-2 rounded hover:opacity-90 transition-opacity"
                        >
                            Next
                            <svg
                                class="inline-block w-4 h-4 ml-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Contact Info -->
                <div class="form-step" data-step="4">
                    <h3 class="text-xl mb-4 font-doto">Your Details</h3>
                    <p class="text-muted-foreground text-sm mb-4">
                        How can we reach you?
                    </p>
                    <div class="grid gap-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2"
                                    >First Name</label
                                >
                                <input
                                    type="text"
                                    name="first_name"
                                    placeholder="John"
                                    class="w-full p-3 border rounded bg-background text-foreground"
                                    required
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2"
                                    >Last Name</label
                                >
                                <input
                                    type="text"
                                    name="last_name"
                                    placeholder="Doe"
                                    class="w-full p-3 border rounded bg-background text-foreground"
                                    required
                                />
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2"
                                >Email</label
                            >
                            <input
                                type="email"
                                name="email"
                                placeholder="john@example.com"
                                class="w-full p-3 border rounded bg-background text-foreground"
                                required
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2"
                                >Phone</label
                            >
                            <input
                                type="tel"
                                name="phone"
                                placeholder="(123) 456-7890"
                                class="w-full p-3 border rounded bg-background text-foreground"
                                required
                            />
                        </div>
                    </div>
                    <div class="flex justify-between mt-6">
                        <button
                            type="button"
                            class="btn-prev border border-foreground/20 px-6 py-2 rounded hover:bg-muted transition-colors"
                        >
                            <svg
                                class="inline-block w-4 h-4 mr-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Back
                        </button>
                        <button
                            type="submit"
                            class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors"
                        >
                            Submit Request
                            <svg
                                class="inline-block w-4 h-4 ml-1"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>

            <!-- Loading State -->
            <div id="booking-loading" class="booking-state hidden">
                <div class="loading-spinner"></div>
                <p class="mt-4 text-lg">Submitting your request...</p>
            </div>

            <!-- Success State -->
            <div id="booking-success" class="booking-state hidden">
                <div class="success-icon">
                    <svg
                        class="w-16 h-16 text-green-500"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold mt-4 font-doto">Booking Sent!</h3>
                <p class="text-muted-foreground mt-2">
                    We'll get back to you within 24-48 hours.
                </p>
                <button
                    id="booking-done"
                    class="mt-6 bg-primary text-primary-foreground px-6 py-2 rounded hover:opacity-90 transition-opacity"
                >
                    Done
                </button>
            </div>
        </div>
    </div>
</dialog>

<style>
    .booking-modal {
        position: fixed;
        max-width: 540px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        padding: 0;
        border: none;
        border-radius: var(--radius);
        background: hsl(var(--background));
        color: hsl(var(--foreground));
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .booking-modal::backdrop {
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
    }

    .booking-modal[open] {
        animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .booking-modal-content {
        position: relative;
        padding: 2rem;
    }

    .booking-modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem;
        border-radius: 50%;
        background: hsl(var(--muted));
        color: hsl(var(--foreground));
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 10;
    }

    .booking-modal-close:hover {
        background: hsl(var(--accent));
        transform: scale(1.1);
    }

    /* Initial Choice Step */
    .booking-choice {
        animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .choice-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .choice-card {
        padding: 1.5rem;
        border: 1px solid hsl(var(--border));
        border-radius: var(--radius);
        background: hsl(var(--muted));
        cursor: pointer;
        text-align: left;
        transition: all 0.2s ease;
    }

    .choice-card:hover {
        border-color: hsl(var(--primary));
        background: hsl(var(--muted) / 0.8);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .choice-card h3 {
        color: hsl(var(--foreground));
    }

    /* Progress Indicator */
    .booking-progress {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.5rem;
        gap: 0;
    }

    .progress-step {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: hsl(var(--muted));
        color: hsl(var(--muted-foreground));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .progress-step.active {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        transform: scale(1.1);
    }

    .progress-step.completed {
        background: hsl(142 76% 36%);
        color: white;
    }

    .progress-line {
        width: 40px;
        height: 3px;
        background: hsl(var(--muted));
        transition: background 0.3s ease;
    }

    .progress-line.active {
        background: hsl(var(--primary));
    }

    /* Form Steps */
    .form-step {
        display: none;
        animation: stepFadeIn 0.3s ease-out;
    }

    .form-step.active {
        display: block;
    }

    @keyframes stepFadeIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Upload Area */
    .upload-area {
        border: 2px dashed hsl(var(--border));
        border-radius: var(--radius);
        padding: 2rem;
        text-align: center;
        transition: all 0.2s ease;
    }

    .upload-area:hover {
        border-color: hsl(var(--primary));
        background: hsl(var(--muted) / 0.5);
    }

    .upload-label {
        cursor: pointer;
        display: block;
    }

    .file-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        justify-content: center;
    }

    .file-preview-item {
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
    }

    .file-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .file-preview-item .remove-file {
        position: absolute;
        top: 2px;
        right: 2px;
        width: 18px;
        height: 18px;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 12px;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* States */
    .booking-state {
        text-align: center;
        padding: 2rem;
    }

    .booking-state.hidden {
        display: none;
    }

    .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid hsl(var(--muted));
        border-top-color: hsl(var(--primary));
        border-radius: 50%;
        margin: 0 auto;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .success-icon {
        animation: successPop 0.4s ease-out;
    }

    @keyframes successPop {
        0% {
            transform: scale(0);
        }
        50% {
            transform: scale(1.2);
        }
        100% {
            transform: scale(1);
        }
    }

    .hidden {
        display: none !important;
    }

    /* Mobile responsiveness */
    @media (max-width: 640px) {
        .booking-modal-content {
            padding: 1.5rem;
        }

        .booking-progress {
            transform: scale(0.9);
        }

        .progress-line {
            width: 24px;
        }

        .form-step .grid-cols-2 {
            grid-template-columns: 1fr;
        }

        .choice-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    import { supabase } from "../lib/supabase";

    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById(
            "booking-modal",
        ) as HTMLDialogElement;
        const closeBtn = document.getElementById("booking-modal-close");
        const doneBtn = document.getElementById("booking-done");
        const form = document.getElementById("booking-form") as HTMLFormElement;
        const loadingEl = document.getElementById("booking-loading");
        const successEl = document.getElementById("booking-success");
        const fileInput = document.getElementById(
            "ref-photos",
        ) as HTMLInputElement;
        const filePreview = document.getElementById("file-preview");

        // Choice elements
        const bookingChoice = document.getElementById("booking-choice");
        const bookingFormContainer = document.getElementById(
            "booking-form-container",
        );
        const choiceCustom = document.getElementById("choice-custom");
        const choiceFlash = document.getElementById("choice-flash");
        const backToChoiceBtn = document.querySelector(".btn-back-to-choice");

        let currentStep = 1;
        const totalSteps = 4;
        let selectedFiles: File[] = [];

        // Listen for custom event to open modal
        window.addEventListener("openBookingModal", () => {
            if (modal) {
                modal.showModal();

                // Check if there's a pre-selected flash design
                const savedDesign = sessionStorage.getItem(
                    "selectedFlashDesign",
                );
                if (savedDesign) {
                    try {
                        const design = JSON.parse(savedDesign);
                        // Pre-populate form with flash design info
                        const ideaField = form?.querySelector(
                            '[name="idea"]',
                        ) as HTMLTextAreaElement;
                        const sizeField = form?.querySelector(
                            '[name="size"]',
                        ) as HTMLSelectElement;

                        if (ideaField) {
                            ideaField.value = `Flash Design: ${design.text}\n\n${design.description}\n\nPrice: $${design.price}`;
                        }

                        // Try to match size
                        if (sizeField && design.size) {
                            if (
                                design.size.includes("1-2") ||
                                design.size.includes("2-3")
                            ) {
                                sizeField.value = "1-2 inches";
                            } else if (
                                design.size.includes("3-4") ||
                                design.size.includes("4-5")
                            ) {
                                sizeField.value = "3-5 inches";
                            } else if (
                                design.size.includes("5-6") ||
                                design.size.includes("6+")
                            ) {
                                sizeField.value = "6+ inches";
                            }
                        }

                        // Clear the stored design
                        sessionStorage.removeItem("selectedFlashDesign");

                        // Skip to custom form directly
                        showCustomForm();
                        return;
                    } catch (e) {
                        console.error("Error parsing flash design:", e);
                        sessionStorage.removeItem("selectedFlashDesign");
                    }
                }

                resetToChoice();
            }
        });

        // Choice handlers
        choiceCustom?.addEventListener("click", () => {
            showCustomForm();
        });

        choiceFlash?.addEventListener("click", () => {
            // Navigate to flash designs page
            modal?.close();
            window.location.href = "/flash-designs";
        });

        // Back to choice from step 1
        backToChoiceBtn?.addEventListener("click", () => {
            showChoice();
        });

        function showCustomForm() {
            bookingChoice?.classList.add("hidden");
            bookingFormContainer?.classList.remove("hidden");
            currentStep = 1;
            showStep(currentStep);
        }

        function showChoice() {
            bookingFormContainer?.classList.add("hidden");
            bookingChoice?.classList.remove("hidden");
        }

        function resetToChoice() {
            currentStep = 1;
            selectedFiles = [];
            form?.reset();
            form?.classList.remove("hidden");
            loadingEl?.classList.add("hidden");
            successEl?.classList.add("hidden");
            if (filePreview) filePreview.innerHTML = "";
            showStep(1);
            showChoice();

            // Remove any validation styling
            document.querySelectorAll(".border-red-500").forEach((el) => {
                el.classList.remove("border-red-500");
            });
        }

        // Close modal handlers
        closeBtn?.addEventListener("click", () => {
            modal?.close();
        });

        doneBtn?.addEventListener("click", () => {
            modal?.close();
            resetToChoice();
        });

        // Close on backdrop click
        modal?.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.close();
            }
        });

        // Close on Escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal?.open) {
                modal.close();
            }
        });

        // Step Navigation
        function updateProgress() {
            const progressSteps = document.querySelectorAll(".progress-step");
            const progressLines = document.querySelectorAll(".progress-line");

            progressSteps.forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove("active", "completed");

                if (stepNum < currentStep) {
                    step.classList.add("completed");
                } else if (stepNum === currentStep) {
                    step.classList.add("active");
                }
            });

            progressLines.forEach((line, index) => {
                line.classList.toggle("active", index < currentStep - 1);
            });
        }

        function showStep(stepNum: number) {
            const steps = document.querySelectorAll(".form-step");
            steps.forEach((step) => {
                step.classList.remove("active");
                if (
                    parseInt(step.getAttribute("data-step") || "0") === stepNum
                ) {
                    step.classList.add("active");
                }
            });
            updateProgress();
        }

        function validateCurrentStep(): boolean {
            const currentStepEl = document.querySelector(
                `[data-step="${currentStep}"]`,
            );
            if (!currentStepEl) return true;

            const requiredInputs = currentStepEl.querySelectorAll(
                "[required]",
            ) as NodeListOf<
                HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement
            >;
            let valid = true;

            requiredInputs.forEach((input) => {
                if (!input.value.trim()) {
                    valid = false;
                    input.classList.add("border-red-500");
                } else {
                    input.classList.remove("border-red-500");
                }
            });

            return valid;
        }

        // Next button handlers
        document.querySelectorAll(".btn-next").forEach((btn) => {
            btn.addEventListener("click", () => {
                if (validateCurrentStep() && currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            });
        });

        // Previous button handlers
        document.querySelectorAll(".btn-prev").forEach((btn) => {
            btn.addEventListener("click", () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });
        });

        // File upload preview
        fileInput?.addEventListener("change", () => {
            if (fileInput.files) {
                selectedFiles = Array.from(fileInput.files);
                updateFilePreview();
            }
        });

        function updateFilePreview() {
            if (!filePreview) return;
            filePreview.innerHTML = "";

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement("div");
                    div.className = "file-preview-item";
                    div.innerHTML = `
            <img src="${e.target?.result}" alt="Preview ${index + 1}" />
            <button type="button" class="remove-file" data-index="${index}">&times;</button>
          `;
                    filePreview.appendChild(div);

                    // Add remove handler
                    div.querySelector(".remove-file")?.addEventListener(
                        "click",
                        () => {
                            selectedFiles.splice(index, 1);
                            updateFilePreview();
                        },
                    );
                };
                reader.readAsDataURL(file);
            });
        }

        // Form submission
        form?.addEventListener("submit", async (e) => {
            e.preventDefault();

            if (!validateCurrentStep()) return;

            // Show loading state
            form.classList.add("hidden");
            loadingEl?.classList.remove("hidden");

            const formData = new FormData(form);
            const uploadedUrls: string[] = [];

            try {
                // Upload images
                for (const file of selectedFiles) {
                    const fileName = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, "")}`;
                    const { data, error } = await supabase.storage
                        .from("reference-photos")
                        .upload(fileName, file);

                    if (data && !error) {
                        const {
                            data: { publicUrl },
                        } = supabase.storage
                            .from("reference-photos")
                            .getPublicUrl(fileName);
                        uploadedUrls.push(publicUrl);
                    }
                }

                // Insert booking
                const { error } = await supabase.from("bookings").insert({
                    first_name: formData.get("first_name"),
                    last_name: formData.get("last_name"),
                    email: formData.get("email"),
                    phone: formData.get("phone"),
                    tattoo_idea: formData.get("idea"),
                    tattoo_placement: formData.get("placement"),
                    tattoo_size: formData.get("size"),
                    is_custom: true,
                    reference_photos: uploadedUrls,
                    status: "pending",
                });

                loadingEl?.classList.add("hidden");

                if (!error) {
                    successEl?.classList.remove("hidden");
                } else {
                    form.classList.remove("hidden");
                    alert("Error submitting booking: " + error.message);
                }
            } catch (err) {
                loadingEl?.classList.add("hidden");
                form.classList.remove("hidden");
                alert("An error occurred. Please try again.");
            }
        });
    });
</script>


--- src\components\CircularGallery.jsx

import { Camera, Mesh, Plane, Program, Renderer, Texture, Transform } from 'ogl';
import { useEffect, useRef } from 'react';

// Utility: Debounce function
function debounce(func, wait) {
    let timeout;
    return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

// Utility: Linear interpolation
function lerp(p1, p2, t) {
    return p1 + (p2 - p1) * t;
}

// Utility: Auto-bind methods to instance
function autoBind(instance) {
    const proto = Object.getPrototypeOf(instance);
    Object.getOwnPropertyNames(proto).forEach(key => {
        if (key !== 'constructor' && typeof instance[key] === 'function') {
            instance[key] = instance[key].bind(instance);
        }
    });
}

// Utility: Create text texture on canvas
function createTextTexture(gl, text, font = 'bold 30px monospace', color = 'black') {
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    context.font = font;
    const metrics = context.measureText(text);
    const textWidth = Math.ceil(metrics.width);
    const textHeight = Math.ceil(parseInt(font, 10) * 1.2);
    canvas.width = textWidth + 20;
    canvas.height = textHeight + 20;
    context.font = font;
    context.fillStyle = color;
    context.textBaseline = 'middle';
    context.textAlign = 'center';
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.fillText(text, canvas.width / 2, canvas.height / 2);
    const texture = new Texture(gl, { generateMipmaps: false });
    texture.image = canvas;
    return { texture, width: canvas.width, height: canvas.height };
}

// Title class for text labels below images
class Title {
    constructor({ gl, plane, renderer, text, textColor = '#545050', font = '30px sans-serif' }) {
        autoBind(this);
        this.gl = gl;
        this.plane = plane;
        this.renderer = renderer;
        this.text = text;
        this.textColor = textColor;
        this.font = font;
        this.createMesh();
    }

    createMesh() {
        const { texture, width, height } = createTextTexture(this.gl, this.text, this.font, this.textColor);
        const geometry = new Plane(this.gl);
        const program = new Program(this.gl, {
            vertex: `
        attribute vec3 position;
        attribute vec2 uv;
        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,
            fragment: `
        precision highp float;
        uniform sampler2D tMap;
        varying vec2 vUv;
        void main() {
          vec4 color = texture2D(tMap, vUv);
          if (color.a < 0.1) discard;
          gl_FragColor = color;
        }
      `,
            uniforms: { tMap: { value: texture } },
            transparent: true
        });
        this.mesh = new Mesh(this.gl, { geometry, program });
        const aspect = width / height;
        const textHeight = this.plane.scale.y * 0.15;
        const textWidth = textHeight * aspect;
        this.mesh.scale.set(textWidth, textHeight, 1);
        this.mesh.position.y = -this.plane.scale.y * 0.5 - textHeight * 0.5 - 0.05;
        this.mesh.setParent(this.plane);
    }
}

// Media class for individual gallery items
class Media {
    constructor({
        geometry,
        gl,
        image,
        index,
        length,
        renderer,
        scene,
        screen,
        text,
        viewport,
        bend,
        textColor,
        borderRadius = 0,
        font,
        onItemClick
    }) {
        this.extra = 0;
        this.geometry = geometry;
        this.gl = gl;
        this.image = image;
        this.index = index;
        this.length = length;
        this.renderer = renderer;
        this.scene = scene;
        this.screen = screen;
        this.text = text;
        this.viewport = viewport;
        this.bend = bend;
        this.textColor = textColor;
        this.borderRadius = borderRadius;
        this.font = font;
        this.onItemClick = onItemClick;
        this.createShader();
        this.createMesh();
        this.createTitle();
        this.onResize();
    }

    createShader() {
        const texture = new Texture(this.gl, {
            generateMipmaps: true
        });
        this.program = new Program(this.gl, {
            depthTest: false,
            depthWrite: false,
            vertex: `
        precision highp float;
        attribute vec3 position;
        attribute vec2 uv;
        uniform mat4 modelViewMatrix;
        uniform mat4 projectionMatrix;
        uniform float uTime;
        uniform float uSpeed;
        varying vec2 vUv;
        void main() {
          vUv = uv;
          vec3 p = position;
          p.z = (sin(p.x * 4.0 + uTime) * 1.5 + cos(p.y * 2.0 + uTime) * 1.5) * (0.1 + uSpeed * 0.5);
          gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);
        }
      `,
            fragment: `
        precision highp float;
        uniform vec2 uImageSizes;
        uniform vec2 uPlaneSizes;
        uniform sampler2D tMap;
        uniform float uBorderRadius;
        varying vec2 vUv;

        float roundedBoxSDF(vec2 p, vec2 b, float r) {
          vec2 d = abs(p) - b;
          return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0) - r;
        }

        void main() {
          vec2 ratio = vec2(
            min((uPlaneSizes.x / uPlaneSizes.y) / (uImageSizes.x / uImageSizes.y), 1.0),
            min((uPlaneSizes.y / uPlaneSizes.x) / (uImageSizes.y / uImageSizes.x), 1.0)
          );
          vec2 uv = vec2(
            vUv.x * ratio.x + (1.0 - ratio.x) * 0.5,
            vUv.y * ratio.y + (1.0 - ratio.y) * 0.5
          );
          vec4 color = texture2D(tMap, uv);

          float d = roundedBoxSDF(vUv - 0.5, vec2(0.5 - uBorderRadius), uBorderRadius);

          // Smooth antialiasing for edges
          float edgeSmooth = 0.002;
          float alpha = 1.0 - smoothstep(-edgeSmooth, edgeSmooth, d);

          gl_FragColor = vec4(color.rgb, alpha);
        }
      `,
            uniforms: {
                tMap: { value: texture },
                uPlaneSizes: { value: [0, 0] },
                uImageSizes: { value: [0, 0] },
                uSpeed: { value: 0 },
                uTime: { value: 100 * Math.random() },
                uBorderRadius: { value: this.borderRadius }
            },
            transparent: true
        });
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.src = this.image;
        img.onload = () => {
            texture.image = img;
            this.program.uniforms.uImageSizes.value = [img.naturalWidth, img.naturalHeight];
        };
    }

    createMesh() {
        this.plane = new Mesh(this.gl, {
            geometry: this.geometry,
            program: this.program
        });
        this.plane.setParent(this.scene);
    }

    createTitle() {
        this.title = new Title({
            gl: this.gl,
            plane: this.plane,
            renderer: this.renderer,
            text: this.text,
            textColor: this.textColor,
            font: this.font
        });
    }

    update(scroll, direction) {
        this.plane.position.x = this.x - scroll.current - this.extra;

        const x = this.plane.position.x;
        const H = this.viewport.width / 2;

        if (this.bend === 0) {
            this.plane.position.y = 0;
            this.plane.rotation.z = 0;
        } else {
            const B_abs = Math.abs(this.bend);
            const R = (H * H + B_abs * B_abs) / (2 * B_abs);
            const effectiveX = Math.min(Math.abs(x), H);

            const arc = R - Math.sqrt(R * R - effectiveX * effectiveX);
            if (this.bend > 0) {
                this.plane.position.y = -arc;
                this.plane.rotation.z = -Math.sign(x) * Math.asin(effectiveX / R);
            } else {
                this.plane.position.y = arc;
                this.plane.rotation.z = Math.sign(x) * Math.asin(effectiveX / R);
            }
        }

        this.speed = scroll.current - scroll.last;
        this.program.uniforms.uTime.value += 0.04;
        this.program.uniforms.uSpeed.value = this.speed;

        const planeOffset = this.plane.scale.x / 2;
        const viewportOffset = this.viewport.width / 2;
        this.isBefore = this.plane.position.x + planeOffset < -viewportOffset;
        this.isAfter = this.plane.position.x - planeOffset > viewportOffset;
        if (direction === 'right' && this.isBefore) {
            this.extra -= this.widthTotal;
            this.isBefore = this.isAfter = false;
        }
        if (direction === 'left' && this.isAfter) {
            this.extra += this.widthTotal;
            this.isBefore = this.isAfter = false;
        }
    }

    onResize({ screen, viewport } = {}) {
        if (screen) this.screen = screen;
        if (viewport) {
            this.viewport = viewport;
            if (this.plane.program.uniforms.uViewportSizes) {
                this.plane.program.uniforms.uViewportSizes.value = [this.viewport.width, this.viewport.height];
            }
        }
        this.scale = this.screen.height / 1500;
        this.plane.scale.y = (this.viewport.height * (900 * this.scale)) / this.screen.height;
        this.plane.scale.x = (this.viewport.width * (700 * this.scale)) / this.screen.width;
        this.plane.program.uniforms.uPlaneSizes.value = [this.plane.scale.x, this.plane.scale.y];
        this.padding = 2;
        this.width = this.plane.scale.x + this.padding;
        this.widthTotal = this.width * this.length;
        this.x = this.width * this.index;
    }
}

// Main App class that manages the gallery
class App {
    constructor(
        container,
        {
            items,
            bend,
            textColor = '#ffffff',
            borderRadius = 0,
            font = 'bold 30px Figtree',
            scrollSpeed = 2,
            scrollEase = 0.05,
            onItemClick
        } = {}
    ) {
        document.documentElement.classList.remove('no-js');
        this.container = container;
        this.scrollSpeed = scrollSpeed;
        this.scroll = { ease: scrollEase, current: 0, target: 0, last: 0 };
        this.onCheckDebounce = debounce(this.onCheck, 200);
        this.onItemClick = onItemClick;
        this.createRenderer();
        this.createCamera();
        this.createScene();
        this.onResize();
        this.createGeometry();
        this.createMedias(items, bend, textColor, borderRadius, font);
        this.update();
        this.addEventListeners();
    }

    createRenderer() {
        this.renderer = new Renderer({
            alpha: true,
            antialias: true,
            dpr: Math.min(window.devicePixelRatio || 1, 2)
        });
        this.gl = this.renderer.gl;
        this.gl.clearColor(0, 0, 0, 0);
        this.container.appendChild(this.gl.canvas);
    }

    createCamera() {
        this.camera = new Camera(this.gl);
        this.camera.fov = 45;
        this.camera.position.z = 20;
    }

    createScene() {
        this.scene = new Transform();
    }

    createGeometry() {
        this.planeGeometry = new Plane(this.gl, {
            heightSegments: 50,
            widthSegments: 100
        });
    }

    createMedias(items, bend = 1, textColor, borderRadius, font) {
        const defaultItems = [
            { image: `https://picsum.photos/seed/1/800/600?grayscale`, text: 'Bridge' },
            { image: `https://picsum.photos/seed/2/800/600?grayscale`, text: 'Desk Setup' },
            { image: `https://picsum.photos/seed/3/800/600?grayscale`, text: 'Waterfall' },
            { image: `https://picsum.photos/seed/4/800/600?grayscale`, text: 'Strawberries' },
            { image: `https://picsum.photos/seed/5/800/600?grayscale`, text: 'Deep Diving' },
            { image: `https://picsum.photos/seed/16/800/600?grayscale`, text: 'Train Track' }
        ];
        const galleryItems = items && items.length ? items : defaultItems;
        this.mediasImages = galleryItems.concat(galleryItems);
        this.medias = this.mediasImages.map((data, index) => {
            return new Media({
                geometry: this.planeGeometry,
                gl: this.gl,
                image: data.image,
                index,
                length: this.mediasImages.length,
                renderer: this.renderer,
                scene: this.scene,
                screen: this.screen,
                text: data.text,
                viewport: this.viewport,
                bend,
                textColor,
                borderRadius,
                font,
                onItemClick: () => {
                    if (this.onItemClick) this.onItemClick(data);
                    window.dispatchEvent(new CustomEvent('openPortfolioModal', { detail: data }));
                }
            });
        });
    }

    onTouchDown(e) {
        this.isDown = true;
        this.isDragging = false;
        this.scroll.position = this.scroll.current;
        this.start = e.touches ? e.touches[0].clientX : e.clientX;
    }

    onTouchMove(e) {
        if (this.isDown) {
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            if (Math.abs(this.start - x) > 5) this.isDragging = true;
            const distance = (this.start - x) * (this.scrollSpeed * 0.025);
            this.scroll.target = this.scroll.position + distance;
        } else {
            if (e.touches || !this.renderer) return;
            const rect = this.renderer.gl.canvas.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            const y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

            if (Math.abs(x) < 0.3 && Math.abs(y) < 0.5) {
                this.container.style.cursor = 'pointer';
            } else {
                this.container.style.cursor = 'grab';
            }
        }
    }

    onTouchUp() {
        this.isDown = false;
        this.onCheck();
    }

    onWheel(e) {
        const delta = e.deltaY || e.wheelDelta || e.detail;
        this.scroll.target += (delta > 0 ? this.scrollSpeed : -this.scrollSpeed) * 0.2;
        this.onCheckDebounce();
    }

    onCheck() {
        if (!this.medias || !this.medias[0]) return;
        const width = this.medias[0].width;
        const itemIndex = Math.round(Math.abs(this.scroll.target) / width);
        const item = width * itemIndex;
        this.scroll.target = this.scroll.target < 0 ? -item : item;
    }

    onClick(e) {
        if (this.isDragging) return;
        const rect = this.renderer.gl.canvas.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
        const y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

        if (Math.abs(x) < 0.3 && Math.abs(y) < 0.5 && this.medias && this.medias[0]) {
            const width = this.medias[0].width;
            const index = Math.round(this.scroll.current / width);
            const mediaLength = this.medias.length;
            const normalizedIndex = ((index % mediaLength) + mediaLength) % mediaLength;

            if (this.medias[normalizedIndex]) {
                this.medias[normalizedIndex].onItemClick();
            }
        }
    }

    onResize() {
        this.screen = {
            width: this.container.clientWidth,
            height: this.container.clientHeight
        };
        this.renderer.setSize(this.screen.width, this.screen.height);
        this.camera.perspective({
            aspect: this.screen.width / this.screen.height
        });
        const fov = (this.camera.fov * Math.PI) / 180;
        const height = 2 * Math.tan(fov / 2) * this.camera.position.z;
        const width = height * this.camera.aspect;
        this.viewport = { width, height };
        if (this.medias) {
            this.medias.forEach(media => media.onResize({ screen: this.screen, viewport: this.viewport }));
        }
    }

    update() {
        this.scroll.current = lerp(this.scroll.current, this.scroll.target, this.scroll.ease);
        const direction = this.scroll.current > this.scroll.last ? 'right' : 'left';
        if (this.medias) {
            this.medias.forEach(media => media.update(this.scroll, direction));
        }
        this.renderer.render({ scene: this.scene, camera: this.camera });
        this.scroll.last = this.scroll.current;
        this.raf = window.requestAnimationFrame(this.update.bind(this));
    }

    addEventListeners() {
        this.boundOnResize = this.onResize.bind(this);
        this.boundOnWheel = this.onWheel.bind(this);
        this.boundOnTouchDown = this.onTouchDown.bind(this);
        this.boundOnTouchMove = this.onTouchMove.bind(this);
        this.boundOnTouchUp = this.onTouchUp.bind(this);
        this.boundOnClick = this.onClick.bind(this);
        window.addEventListener('resize', this.boundOnResize);
        window.addEventListener('mousewheel', this.boundOnWheel);
        window.addEventListener('wheel', this.boundOnWheel);
        window.addEventListener('mousedown', this.boundOnTouchDown);
        window.addEventListener('mousemove', this.boundOnTouchMove);
        window.addEventListener('mouseup', this.boundOnTouchUp);
        window.addEventListener('touchstart', this.boundOnTouchDown);
        window.addEventListener('touchmove', this.boundOnTouchMove);
        window.addEventListener('touchend', this.boundOnTouchUp);
        this.container.addEventListener('click', this.boundOnClick);
    }

    destroy() {
        window.cancelAnimationFrame(this.raf);
        window.removeEventListener('resize', this.boundOnResize);
        window.removeEventListener('mousewheel', this.boundOnWheel);
        window.removeEventListener('wheel', this.boundOnWheel);
        window.removeEventListener('mousedown', this.boundOnTouchDown);
        window.removeEventListener('mousemove', this.boundOnTouchMove);
        window.removeEventListener('mouseup', this.boundOnTouchUp);
        window.removeEventListener('touchstart', this.boundOnTouchDown);
        window.removeEventListener('touchmove', this.boundOnTouchMove);
        window.removeEventListener('touchend', this.boundOnTouchUp);
        this.container.removeEventListener('click', this.boundOnClick);
        if (this.renderer && this.renderer.gl && this.renderer.gl.canvas.parentNode) {
            this.renderer.gl.canvas.parentNode.removeChild(this.renderer.gl.canvas);
        }
    }
}

// Main CircularGallery React component
export default function CircularGallery({
    items,
    bend = 3,
    textColor = '#ffffff',
    borderRadius = 0.05,
    font = 'bold 30px Figtree',
    scrollSpeed = 2,
    scrollEase = 0.05,
    onItemClick = undefined
}) {
    const containerRef = useRef(null);

    useEffect(() => {
        if (!containerRef.current) return;

        const app = new App(containerRef.current, {
            items,
            bend,
            textColor,
            borderRadius,
            font,
            scrollSpeed,
            scrollEase,
            onItemClick
        });

        return () => {
            app.destroy();
        };
    }, [items, bend, textColor, borderRadius, font, scrollSpeed, scrollEase, onItemClick]);

    return <div className="circular-gallery" ref={containerRef} />;
}


--- src\layouts\AdminLayout.astro

---
import "../styles/global.css";

interface Props {
    title: string;
}

const { title } = Astro.props;

// Get current path for active nav highlighting
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>{title} | KowTattys Admin</title>
        <meta name="robots" content="noindex, nofollow" />
    </head>
    <body class="bg-gray-100 dark:bg-gray-900 min-h-screen">
        <!-- Auth Check Script -->
        <script>
            import { supabase } from "../lib/supabase";

            async function checkAuth() {
                const {
                    data: { session },
                } = await supabase.auth.getSession();

                if (!session) {
                    window.location.href = "/admin/login";
                }
            }

            checkAuth();

            // Listen for auth state changes
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === "SIGNED_OUT" || !session) {
                    // Clear session cookies
                    document.cookie =
                        "sb-access-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax; secure";
                    document.cookie =
                        "sb-refresh-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax; secure";

                    window.location.href = "/admin/login";
                }
            });
        </script>

        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <aside
                class="w-64 bg-gray-900 text-white flex flex-col fixed h-full"
            >
                <!-- Logo -->
                <div class="p-6 border-b border-gray-800">
                    <a href="/admin" class="text-2xl font-bold font-doto">
                        KowTattys
                    </a>
                    <p class="text-gray-400 text-sm mt-1">Admin Panel</p>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 p-4">
                    <ul class="space-y-2">
                        <li>
                            <a
                                href="/admin"
                                class:list={[
                                    "flex items-center gap-3 px-4 py-3 rounded-lg transition-colors",
                                    currentPath === "/admin" ||
                                    currentPath === "/admin/"
                                        ? "bg-primary text-white"
                                        : "text-gray-300 hover:bg-gray-800",
                                ]}
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                                    ></path>
                                </svg>
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a
                                href="/admin/bookings"
                                class:list={[
                                    "flex items-center gap-3 px-4 py-3 rounded-lg transition-colors",
                                    currentPath.startsWith("/admin/bookings")
                                        ? "bg-primary text-white"
                                        : "text-gray-300 hover:bg-gray-800",
                                ]}
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                    ></path>
                                </svg>
                                Bookings
                            </a>
                        </li>
                        <li>
                            <a
                                href="/admin/cms"
                                class:list={[
                                    "flex items-center gap-3 px-4 py-3 rounded-lg transition-colors",
                                    currentPath.startsWith("/admin/cms")
                                        ? "bg-primary text-white"
                                        : "text-gray-300 hover:bg-gray-800",
                                ]}
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                                    ></path>
                                </svg>
                                Content (CMS)
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Footer -->
                <div class="p-4 border-t border-gray-800">
                    <a
                        href="/"
                        class="flex items-center gap-3 px-4 py-3 text-gray-300 hover:bg-gray-800 rounded-lg transition-colors"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                            ></path>
                        </svg>
                        View Site
                    </a>
                    <button
                        id="logout-btn"
                        class="flex items-center gap-3 px-4 py-3 text-red-400 hover:bg-gray-800 rounded-lg transition-colors w-full mt-2"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                            ></path>
                        </svg>
                        Logout
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 ml-64">
                <!-- Top Bar -->
                <header
                    class="bg-white dark:bg-gray-800 shadow-sm px-8 py-4 sticky top-0 z-10"
                >
                    <h1
                        class="text-2xl font-bold text-gray-900 dark:text-white"
                    >
                        {title}
                    </h1>
                </header>

                <!-- Page Content -->
                <div class="p-8">
                    <slot />
                </div>
            </main>
        </div>

        <script>
            import { supabase } from "../lib/supabase";

            document
                .getElementById("logout-btn")
                ?.addEventListener("click", async () => {
                    await supabase.auth.signOut();

                    // Clear session cookies
                    document.cookie =
                        "sb-access-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax; secure";
                    document.cookie =
                        "sb-refresh-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax; secure";

                    window.location.href = "/admin/login";
                });
        </script>

        <style>
            :root {
                --primary: 271 81% 51%;
            }

            .bg-primary {
                background-color: hsl(271, 81%, 51%);
            }
        </style>
    </body>
</html>



---
import "../styles/global.css";
import BookingModal from "../components/BookingModal.astro";

interface Props {
    title: string;
    description?: string;
}

const { title, description = "Toronto's premiere tattoo experience" } =
    Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>{title}</title>
        <!-- Prevent Flash of Incorrect Theme -->
        <script is:inline>
            const theme = (() => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            })();
            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>
    </head>
    <body
        class="bg-background text-foreground font-playfair min-h-screen flex flex-col"
    >
        <header
            class="fixed w-full z-50 bg-background/80 backdrop-blur-sm border-b"
        >
            <div
                class="container mx-auto px-4 h-16 flex justify-between items-center"
            >
                <a href="/" class="font-doto text-4xl font-bold">KowTattys</a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="/" class="hover:text-primary transition-colors"
                        >Home</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors">Flash</a
                    >
                    <button
                        class="booking-trigger hover:text-primary transition-colors cursor-pointer bg-transparent border-none font-inherit text-inherit"
                    >
                        Book Now
                    </button>
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >

                    <div class="flex items-center gap-2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-yellow-500"
                            ><circle cx="12" cy="12" r="5"></circle><path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                            ></path></svg
                        >

                        <button
                            id="theme-toggle"
                            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 transition-colors duration-300 focus:outline-none"
                            aria-label="Toggle Theme"
                        >
                            <div
                                class="absolute top-[2px] left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-transform duration-300 dark:translate-x-full dark:border-gray-600"
                            >
                            </div>
                        </button>

                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-gray-700 dark:text-gray-300"
                            ><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"
                            ></path></svg
                        >
                    </div>
                </nav>

                <!-- Mobile Menu Button -->
                <button
                    id="mobile-menu-btn"
                    class="md:hidden p-2 text-foreground focus:outline-none"
                    aria-label="Toggle mobile menu"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile Menu Dropdown -->
            <div
                id="mobile-menu"
                class="hidden md:hidden bg-background/95 backdrop-blur-sm border-b transition-all duration-300 ease-in-out"
            >
                <nav class="flex flex-col p-4 space-y-4">
                    <a
                        href="/"
                        class="text-lg hover:text-primary transition-colors"
                        >Home</a
                    >
                    <a
                        href="/portfolio"
                        class="text-lg hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="text-lg hover:text-primary transition-colors"
                        >Flash</a
                    >
                    <button
                        class="booking-trigger text-lg hover:text-primary transition-colors cursor-pointer bg-transparent border-none font-inherit text-inherit text-left"
                    >
                        Book Now
                    </button>
                    <a
                        href="/contact"
                        class="text-lg hover:text-primary transition-colors"
                        >Contact</a
                    >
                    <div class="flex items-center gap-2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-yellow-500"
                            ><circle cx="12" cy="12" r="5"></circle><path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                            ></path></svg
                        >

                        <button
                            id="theme-toggle-mobile"
                            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 transition-colors duration-300 focus:outline-none"
                            aria-label="Toggle Theme"
                        >
                            <div
                                class="absolute top-[2px] left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-transform duration-300 dark:translate-x-full dark:border-gray-600"
                            >
                            </div>
                        </button>

                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-gray-700 dark:text-gray-300"
                            ><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"
                            ></path></svg
                        >
                    </div>
                </nav>
            </div>
        </header>

        <main class="flex-grow pt-16">
            <slot />
        </main>

        <footer class="bg-background border-t py-8 mt-20">
            <div
                class="container mx-auto px-4 text-center text-muted-foreground"
            >
                <div class="flex justify-center gap-6 mb-4">
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >
                    <a
                        href="/policy"
                        class="hover:text-primary transition-colors">Policies</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors"
                        >Flash Designs</a
                    >
                </div>
                <p>
                    &copy; {new Date().getFullYear()} Kow Tattys. All rights reserved.
                </p>
            </div>
        </footer>

        <!-- Global Booking Modal -->
        <BookingModal />

        <script>
            // Vanilla JS for Theme Toggle
            const handleToggleClick = () => {
                const element = document.documentElement;
                element.classList.toggle("dark");
                const isDark = element.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            };

            // Attach to both desktop and mobile toggle buttons
            ["theme-toggle", "theme-toggle-mobile"].forEach((id) => {
                document
                    .getElementById(id)
                    ?.addEventListener("click", handleToggleClick);
            });

            // Vanilla JS for Mobile Menu Toggle
            const btn = document.getElementById("mobile-menu-btn");
            const menu = document.getElementById("mobile-menu");

            btn?.addEventListener("click", () => {
                menu?.classList.toggle("hidden");
            });

            // Booking Modal Triggers
            document.querySelectorAll(".booking-trigger").forEach((trigger) => {
                trigger.addEventListener("click", (e) => {
                    e.preventDefault();
                    // Close mobile menu if open
                    menu?.classList.add("hidden");
                    // Dispatch custom event to open booking modal
                    window.dispatchEvent(new CustomEvent("openBookingModal"));
                });
            });
        </script>
    </body>
</html>


--- src\lib\supabase.ts

import { createClient, SupabaseClient } from "@supabase/supabase-js";

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL || "";
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY || "";
const supabaseServiceKey = import.meta.env.SUPABASE_SERVICE_ROLE_KEY || "";

// In SSR mode, we use the service role key on the server for full access (bypassing RLS),
// and the anon key on the client side.
const isServer = import.meta.env.SSR;
const supabaseKey = isServer
  ? supabaseServiceKey || supabaseAnonKey
  : supabaseAnonKey;

// Validate environment variables
if (!supabaseUrl || !supabaseKey) {
  if (isServer) {
    console.warn(
      "⚠️ Supabase environment variables are not set. Please ensure PUBLIC_SUPABASE_URL and PUBLIC_SUPABASE_ANON_KEY (or SUPABASE_SERVICE_ROLE_KEY) are defined.",
    );
  }
}

// Create client with SSR-compatible configuration
export const supabase: SupabaseClient =
  supabaseUrl && supabaseKey
    ? createClient(supabaseUrl, supabaseKey, {
        auth: {
          persistSession: !isServer,
          autoRefreshToken: !isServer,
          detectSessionInUrl: !isServer,
        },
      })
    : createClient("https://placeholder.supabase.co", "placeholder-key");

// ============================================
// Type Definitions
// ============================================

export type BookingStatus = "pending" | "accepted" | "denied";

export interface Booking {
  id: string;
  created_at: string;
  first_name: string;
  last_name: string;
  email: string;
  phone: string;
  tattoo_idea: string;
  tattoo_placement: string;
  tattoo_size: string;
  is_custom: boolean;
  reference_photos: string[];
  status: BookingStatus;
  admin_notes?: string;
  client_access_token?: string;
  agreed_price?: number;
  scheduled_date?: string;
}

export type ImageCategory = "featured" | "portfolio" | "flash";

export interface ContentImage {
  id: string;
  created_at: string;
  url: string;
  category: ImageCategory;
  title: string;
  description?: string;
  price?: number;
  size?: string;
  is_featured: boolean;
  display_order?: number;
}

export interface SiteSetting {
  id: string;
  key: string;
  value: string;
  created_at: string;
}

export type MessageSenderRole = "admin" | "client";

export interface Message {
  id: string;
  created_at: string;
  booking_id: string;
  sender_role: MessageSenderRole;
  content: string;
}

// ============================================
// Content Images Helpers
// ============================================

export async function getContentImages(category?: ImageCategory) {
  let query = supabase
    .from("content_images")
    .select("*")
    .order("display_order", { ascending: true });

  if (category) {
    query = query.eq("category", category);
  }

  const { data, error } = await query;
  if (error) throw error;
  return data as ContentImage[];
}

export async function getFeaturedImages() {
  const { data, error } = await supabase
    .from("content_images")
    .select("*")
    .eq("is_featured", true)
    .order("display_order", { ascending: true });

  if (error) throw error;
  return data as ContentImage[];
}

export async function getPortfolioImages() {
  return getContentImages("portfolio");
}

export async function getFlashDesigns() {
  return getContentImages("flash");
}

export async function createContentImage(
  image: Omit<ContentImage, "id" | "created_at">,
) {
  const { data, error } = await supabase
    .from("content_images")
    .insert(image)
    .select()
    .single();

  if (error) throw error;
  return data as ContentImage;
}

export async function updateContentImage(
  id: string,
  updates: Partial<ContentImage>,
) {
  const { data, error } = await supabase
    .from("content_images")
    .update(updates)
    .eq("id", id)
    .select()
    .single();

  if (error) throw error;
  return data as ContentImage;
}

export async function deleteContentImage(id: string) {
  const { error } = await supabase.from("content_images").delete().eq("id", id);

  if (error) throw error;
}

// ============================================
// Site Settings Helpers
// ============================================

export async function getSiteSetting(key: string): Promise<string | null> {
  const { data, error } = await supabase
    .from("site_settings")
    .select("value")
    .eq("key", key)
    .single();

  if (error) {
    if (error.code === "PGRST116") return null; // Not found
    throw error;
  }
  return data?.value ?? null;
}

export async function setSiteSetting(key: string, value: string) {
  const { data, error } = await supabase
    .from("site_settings")
    .upsert(
      { key, value, created_at: new Date().toISOString() },
      { onConflict: "key" },
    )
    .select()
    .single();

  if (error) throw error;
  return data as SiteSetting;
}

export async function getContactInfo() {
  return getSiteSetting("contact_info");
}

export async function getPolicyText() {
  return getSiteSetting("policy_text");
}

// ============================================
// Bookings Helpers
// ============================================

export async function getBookings(status?: BookingStatus) {
  let query = supabase
    .from("bookings")
    .select("*")
    .order("created_at", { ascending: false });

  if (status) {
    query = query.eq("status", status);
  }

  const { data, error } = await query;
  if (error) throw error;
  return data as Booking[];
}

export async function getBookingById(id: string) {
  const { data, error } = await supabase
    .from("bookings")
    .select("*")
    .eq("id", id)
    .single();

  if (error) throw error;
  return data as Booking;
}

export async function getBookingByToken(token: string) {
  const { data, error } = await supabase
    .from("bookings")
    .select("*")
    .eq("client_access_token", token)
    .single();

  if (error) {
    if (error.code === "PGRST116") return null; // Not found
    throw error;
  }
  return data as Booking;
}

export async function updateBookingStatus(
  id: string,
  status: BookingStatus,
  adminNotes?: string,
) {
  const updates: Partial<Booking> = { status };
  if (adminNotes !== undefined) {
    updates.admin_notes = adminNotes;
  }

  const { data, error } = await supabase
    .from("bookings")
    .update(updates)
    .eq("id", id)
    .select()
    .single();

  if (error) throw error;
  return data as Booking;
}

export async function updateBooking(id: string, updates: Partial<Booking>) {
  const { data, error } = await supabase
    .from("bookings")
    .update(updates)
    .eq("id", id)
    .select()
    .single();

  if (error) throw error;
  return data as Booking;
}

export function generateClientToken(): string {
  return crypto.randomUUID();
}

// ============================================
// Messages Helpers
// ============================================

export async function getMessages(bookingId: string) {
  const { data, error } = await supabase
    .from("messages")
    .select("*")
    .eq("booking_id", bookingId)
    .order("created_at", { ascending: true });

  if (error) throw error;
  return data as Message[];
}

export async function sendMessage(
  bookingId: string,
  senderRole: MessageSenderRole,
  content: string,
) {
  const { data, error } = await supabase
    .from("messages")
    .insert({
      booking_id: bookingId,
      sender_role: senderRole,
      content,
    })
    .select()
    .single();

  if (error) throw error;
  return data as Message;
}

export function subscribeToMessages(
  bookingId: string,
  callback: (message: Message) => void,
) {
  const channel = supabase
    .channel(`messages:${bookingId}`)
    .on(
      "postgres_changes",
      {
        event: "INSERT",
        schema: "public",
        table: "messages",
        filter: `booking_id=eq.${bookingId}`,
      },
      (payload) => {
        callback(payload.new as Message);
      },
    )
    .subscribe();

  return () => {
    supabase.removeChannel(channel);
  };
}

// ============================================
// Auth Helpers
// ============================================

export async function signIn(email: string, password: string) {
  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password,
  });

  if (error) throw error;
  return data;
}

export async function signOut() {
  const { error } = await supabase.auth.signOut();
  if (error) throw error;
}

export async function getSession() {
  const {
    data: { session },
    error,
  } = await supabase.auth.getSession();
  if (error) throw error;
  return session;
}

export async function getUser() {
  const {
    data: { user },
    error,
  } = await supabase.auth.getUser();
  if (error) throw error;
  return user;
}

// ============================================
// Storage Helpers
// ============================================

export async function uploadImage(bucket: string, file: File, path?: string) {
  const fileName =
    path || `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, "")}`;

  const { data, error } = await supabase.storage
    .from(bucket)
    .upload(fileName, file);

  if (error) throw error;

  const {
    data: { publicUrl },
  } = supabase.storage.from(bucket).getPublicUrl(fileName);

  return { path: data.path, publicUrl };
}

export async function deleteImage(bucket: string, path: string) {
  const { error } = await supabase.storage.from(bucket).remove([path]);

  if (error) throw error;
}


--- src\pages\contact.astro

---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";

// Fetch contact info from site_settings
let contactContent = "";

try {
    const { data } = await supabase
        .from("site_settings")
        .select("value")
        .eq("key", "contact_info")
        .single();

    contactContent = data?.value || "";
} catch (error) {
    console.error("Error fetching contact info:", error);
}

// Default content if nothing in database
const defaultContent = `
# Get in Touch

We'd love to hear from you! Whether you have questions about our work, want to discuss a custom design, or are ready to book your next tattoo, we're here to help.

## Studio Location

**KowTattys Tattoo Studio**
123 Ink Street
Toronto, ON M5V 1A1
Canada

## Hours of Operation

- **Monday - Friday:** 11:00 AM - 8:00 PM
- **Saturday:** 12:00 PM - 6:00 PM
- **Sunday:** Closed

## Contact Methods

- **Email:** info@kowtattys.com
- **Phone:** (416) 555-TATT
- **Instagram:** @kowtattys

## Before Your Visit

Please note that all tattoo sessions require a booking. Walk-ins are welcome for consultations only.

For custom designs, we recommend reaching out at least 2-3 weeks in advance to allow time for design development.
`;

const displayContent = contactContent || defaultContent;

// Simple markdown-like parsing
function parseContent(content: string) {
    return content
        .split('\n')
        .map(line => {
            // Headers
            if (line.startsWith('### ')) {
                return `<h3 class="text-xl font-bold mt-6 mb-3 font-doto">${line.slice(4)}</h3>`;
            }
            if (line.startsWith('## ')) {
                return `<h2 class="text-2xl font-bold mt-8 mb-4 font-doto">${line.slice(3)}</h2>`;
            }
            if (line.startsWith('# ')) {
                return `<h1 class="text-4xl font-bold mb-6 font-doto">${line.slice(2)}</h1>`;
            }
            // Bold text
            line = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // List items
            if (line.startsWith('- ')) {
                return `<li class="ml-4 mb-2">${line.slice(2)}</li>`;
            }
            // Empty lines
            if (line.trim() === '') {
                return '<br />';
            }
            // Regular paragraphs
            return `<p class="mb-4 text-muted-foreground">${line}</p>`;
        })
        .join('\n');
}
---

<Layout title="Contact | KowTattys">
    <div class="container mx-auto px-4 py-12 max-w-4xl">
        <!-- Hero Section -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold font-doto mb-4">Contact Us</h1>
            <p class="text-xl text-muted-foreground">
                Ready to get inked? Let's talk.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8">
                    <article class="prose dark:prose-invert max-w-none">
                        <Fragment set:html={parseContent(displayContent)} />
                    </article>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Quick Contact Card -->
                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800 p-6">
                    <h3 class="text-lg font-semibold text-purple-900 dark:text-purple-100 mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Quick Actions
                    </h3>
                    <div class="space-y-3">
                        <button
                            class="booking-trigger w-full py-3 px-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center gap-2"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Book an Appointment
                        </button>
                        <a
                            href="/flash-designs"
                            class="w-full py-3 px-4 bg-white dark:bg-gray-800 text-purple-600 dark:text-purple-400 border border-purple-300 dark:border-purple-700 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/30 transition-colors font-medium flex items-center justify-center gap-2"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Browse Flash Designs
                        </a>
                    </div>
                </div>

                <!-- Social Media -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        Follow Us
                    </h3>
                    <div class="flex gap-4">
                        <a
                            href="https://instagram.com/kowtattys"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="p-3 bg-gradient-to-br from-purple-600 to-pink-500 text-white rounded-lg hover:opacity-90 transition-opacity"
                            aria-label="Instagram"
                        >
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a
                            href="https://twitter.com/kowtattys"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="p-3 bg-black text-white rounded-lg hover:opacity-90 transition-opacity"
                            aria-label="Twitter/X"
                        >
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a
                            href="https://tiktok.com/@kowtattys"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="p-3 bg-gray-900 text-white rounded-lg hover:opacity-90 transition-opacity"
                            aria-label="TikTok"
                        >
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
                            </svg>
                        </a>
                    </div>
                </div>

                <!-- Map Placeholder -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                    <div class="aspect-video bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                        <div class="text-center text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <p class="text-sm">Toronto, ON</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</Layout>

<style>
    article h1 {
        @apply text-4xl font-bold mb-6;
    }

    article h2 {
        @apply text-2xl font-bold mt-8 mb-4;
    }

    article h3 {
        @apply text-xl font-bold mt-6 mb-3;
    }

    article p {
        @apply mb-4 text-gray-700 dark:text-gray-300;
    }

    article ul {
        @apply list-disc list-inside mb-4;
    }

    article li {
        @apply mb-2 text-gray-700 dark:text-gray-300;
    }

    article strong {
        @apply font-semibold text-gray-900 dark:text-white;
    }
</style>


--- src\pages\flash-designs.astro

---
import Layout from "../layouts/Layout.astro";
import CircularGallery from "../components/CircularGallery.jsx";
import { supabase } from "../lib/supabase";

// Default/fallback flash designs data
const defaultFlashDesigns = [
    {
        image: "/images/home/h1.jpeg",
        text: "Minimalist Rose",
        description:
            "A delicate single-line rose design perfect for wrist or ankle placement. Clean, elegant, and timeless.",
        price: 150,
        size: "2-3 inches",
    },
    {
        image: "/images/home/h2.jpeg",
        text: "Geometric Wolf",
        description:
            "A striking geometric wolf portrait combining sharp angles with natural form. Ideal for forearm or shoulder.",
        price: 250,
        size: "4-5 inches",
    },
    {
        image: "/images/home/h3.jpeg",
        text: "Celestial Moon",
        description:
            "Crescent moon with intricate dotwork details and stars. Perfect for upper arm or back placement.",
        price: 200,
        size: "3-4 inches",
    },
    {
        image: "/images/home/h4.jpeg",
        text: "Japanese Koi",
        description:
            "Traditional Japanese koi fish with flowing water elements. A symbol of perseverance and strength.",
        price: 350,
        size: "5-6 inches",
    },
    {
        image: "/images/home/h5.jpeg",
        text: "Butterfly Collection",
        description:
            "A set of three delicate butterflies in varying sizes. Can be placed together or separately.",
        price: 180,
        size: "1-2 inches each",
    },
    {
        image: "/images/home/h6.jpeg",
        text: "Sacred Heart",
        description:
            "Classic sacred heart design with modern styling. Rich in symbolism and visual impact.",
        price: 275,
        size: "4-5 inches",
    },
    {
        image: "/images/portfolio/dragon.png",
        text: "Dragon Serpent",
        description:
            "Coiling dragon with detailed scales and fierce expression. A bold statement piece.",
        price: 400,
        size: "6+ inches",
    },
    {
        image: "/images/portfolio/naruto.png",
        text: "Anime Flash",
        description:
            "Anime-inspired design with vibrant energy. Perfect for fans looking to show their passion.",
        price: 300,
        size: "4-5 inches",
    },
];

// Try to fetch flash designs from database
let flashDesigns = defaultFlashDesigns;

try {
    const { data: flashImages } = await supabase
        .from("content_images")
        .select("*")
        .eq("category", "flash")
        .order("display_order", { ascending: true });

    if (flashImages && flashImages.length > 0) {
        flashDesigns = flashImages.map((img: any) => ({
            image: img.url,
            text: img.title || "Flash Design",
            description: img.description || "",
            price: img.price || 200,
            size: img.size || "Varies",
        }));
    }
} catch (error) {
    console.error("Error fetching flash designs:", error);
    // Fall back to default flash designs
}
---

<Layout title="Flash Designs | KowTattys">
    <div class="container mx-auto px-4 py-12">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4 font-doto">Flash Designs</h1>
            <p class="text-muted-foreground text-lg max-w-2xl mx-auto">
                Ready-to-ink designs at fixed prices. Pick your favorite and
                book your session today!
            </p>
        </div>

        <!-- Circular Gallery Container -->
        <div id="gallery-container" class="gallery-wrapper">
            <CircularGallery
                client:only="react"
                items={flashDesigns}
                bend={2.5}
                textColor="#ffffff"
                borderRadius={0.08}
                font="bold 28px Doto"
                scrollSpeed={2}
                scrollEase={0.07}
            />
            <div class="gallery-instructions">
                Scroll or drag to explore • Click to view details
            </div>
        </div>

        <!-- Design Grid (Alternative view) -->
        <div class="mt-16">
            <h2 class="text-3xl font-bold text-center mb-8 font-doto">
                All Designs
            </h2>
            <div
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
            >
                {
                    flashDesigns.map((design, index) => (
                        <div
                            class="flash-card group cursor-pointer"
                            data-index={index}
                        >
                            <div class="relative aspect-square overflow-hidden rounded-lg">
                                <img
                                    src={design.image}
                                    alt={design.text}
                                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                                    loading="lazy"
                                />
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                                <div class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                                    <p class="text-white font-semibold">
                                        {design.text}
                                    </p>
                                    <p class="text-green-400 font-bold">
                                        ${design.price}
                                    </p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h3 class="font-semibold text-foreground">
                                    {design.text}
                                </h3>
                                <p class="text-sm text-muted-foreground">
                                    {design.size}
                                </p>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>

    <!-- Flash Design Modal -->
    <dialog
        id="flash-modal"
        class="backdrop:bg-black/80 rounded-lg p-0 bg-background max-w-4xl w-full max-h-[90vh]"
    >
        <div class="relative">
            <button
                id="close-modal"
                class="absolute top-4 right-4 z-10 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition-colors"
                aria-label="Close modal"
            >
                <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <div class="grid md:grid-cols-2">
                <div class="bg-black flex items-center justify-center p-4">
                    <img
                        id="modal-image"
                        src=""
                        alt=""
                        class="max-h-[50vh] md:max-h-[70vh] w-auto object-contain rounded-lg"
                    />
                </div>
                <div class="p-8 flex flex-col">
                    <h2
                        id="modal-title"
                        class="text-2xl font-bold mb-2 font-doto"
                    >
                    </h2>
                    <p
                        id="modal-size"
                        class="text-sm text-muted-foreground mb-4"
                    >
                    </p>
                    <p id="modal-desc" class="text-muted-foreground mb-6"></p>

                    <div
                        class="mt-auto pt-6 border-t border-border flex items-center justify-between"
                    >
                        <div>
                            <p class="text-sm text-muted-foreground">
                                Fixed Price
                            </p>
                            <p
                                id="modal-price"
                                class="text-3xl font-bold text-green-500"
                            >
                            </p>
                        </div>
                        <button
                            id="book-flash-btn"
                            class="bg-primary text-primary-foreground px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                        >
                            Book This Design
                        </button>
                    </div>

                    <p class="text-xs text-muted-foreground mt-4">
                        * Price includes consultation, design prep, and single
                        session. Additional sessions may incur extra charges.
                    </p>
                </div>
            </div>
        </div>
    </dialog>
</Layout>

<script>
    // Store flash designs data for modal access
    const flashDesigns = [
        {
            image: "/images/home/h1.jpeg",
            text: "Minimalist Rose",
            description:
                "A delicate single-line rose design perfect for wrist or ankle placement. Clean, elegant, and timeless.",
            price: 150,
            size: "2-3 inches",
        },
        {
            image: "/images/home/h2.jpeg",
            text: "Geometric Wolf",
            description:
                "A striking geometric wolf portrait combining sharp angles with natural form. Ideal for forearm or shoulder.",
            price: 250,
            size: "4-5 inches",
        },
        {
            image: "/images/home/h3.jpeg",
            text: "Celestial Moon",
            description:
                "Crescent moon with intricate dotwork details and stars. Perfect for upper arm or back placement.",
            price: 200,
            size: "3-4 inches",
        },
        {
            image: "/images/home/h4.jpeg",
            text: "Japanese Koi",
            description:
                "Traditional Japanese koi fish with flowing water elements. A symbol of perseverance and strength.",
            price: 350,
            size: "5-6 inches",
        },
        {
            image: "/images/home/h5.jpeg",
            text: "Butterfly Collection",
            description:
                "A set of three delicate butterflies in varying sizes. Can be placed together or separately.",
            price: 180,
            size: "1-2 inches each",
        },
        {
            image: "/images/home/h6.jpeg",
            text: "Sacred Heart",
            description:
                "Classic sacred heart design with modern styling. Rich in symbolism and visual impact.",
            price: 275,
            size: "4-5 inches",
        },
        {
            image: "/images/portfolio/dragon.png",
            text: "Dragon Serpent",
            description:
                "Coiling dragon with detailed scales and fierce expression. A bold statement piece.",
            price: 400,
            size: "6+ inches",
        },
        {
            image: "/images/portfolio/naruto.png",
            text: "Anime Flash",
            description:
                "Anime-inspired design with vibrant energy. Perfect for fans looking to show their passion.",
            price: 300,
            size: "4-5 inches",
        },
    ];

    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById(
            "flash-modal",
        ) as HTMLDialogElement;
        const closeBtn = document.getElementById("close-modal");
        const modalImg = document.getElementById(
            "modal-image",
        ) as HTMLImageElement;
        const modalTitle = document.getElementById("modal-title");
        const modalDesc = document.getElementById("modal-desc");
        const modalPrice = document.getElementById("modal-price");
        const modalSize = document.getElementById("modal-size");
        const bookFlashBtn = document.getElementById("book-flash-btn");

        let currentDesign: (typeof flashDesigns)[0] | null = null;

        function openModal(design: (typeof flashDesigns)[0]) {
            currentDesign = design;
            if (modalImg) modalImg.src = design.image || "";
            if (modalTitle) modalTitle.textContent = design.text || "";
            if (modalDesc) modalDesc.textContent = design.description || "";
            if (modalPrice) modalPrice.textContent = `$${design.price}`;
            if (modalSize) modalSize.textContent = `Size: ${design.size}`;
            modal.showModal();
        }

        // Close modal on button click
        closeBtn?.addEventListener("click", () => modal.close());

        // Close on backdrop click
        modal.addEventListener("click", (e) => {
            const rect = modal.getBoundingClientRect();
            if (
                e.clientX < rect.left ||
                e.clientX > rect.right ||
                e.clientY < rect.top ||
                e.clientY > rect.bottom
            ) {
                modal.close();
            }
        });

        // Close on Escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal.open) {
                modal.close();
            }
        });

        // Listen for custom event from gallery items (CircularGallery)
        window.addEventListener("openPortfolioModal", ((e: CustomEvent) => {
            const { image, text, description } = e.detail;
            // Find matching design by image or text
            const design = flashDesigns.find(
                (d) => d.image === image || d.text === text,
            );
            if (design) {
                openModal(design);
            } else {
                // Fallback for items not in our list
                openModal({
                    image,
                    text,
                    description: description || "",
                    price: 200,
                    size: "Varies",
                });
            }
        }) as EventListener);

        // Flash card click handlers (grid view)
        document.querySelectorAll(".flash-card").forEach((card) => {
            card.addEventListener("click", () => {
                const index = parseInt(
                    card.getAttribute("data-index") || "0",
                    10,
                );
                const design = flashDesigns[index];
                if (design) {
                    openModal(design);
                }
            });
        });

        // Book This Design button
        bookFlashBtn?.addEventListener("click", () => {
            modal.close();
            // Store the selected design info for the booking form
            if (currentDesign) {
                sessionStorage.setItem(
                    "selectedFlashDesign",
                    JSON.stringify(currentDesign),
                );
            }
            // Open the booking modal
            window.dispatchEvent(new CustomEvent("openBookingModal"));
        });
    });
</script>

<style>
    .gallery-wrapper {
        position: relative;
        height: 70vh;
        min-height: 450px;
        width: 100%;
        margin-bottom: 2rem;
    }

    .gallery-wrapper :global(.circular-gallery) {
        width: 100%;
        height: 100%;
    }

    .flash-card {
        transition: transform 0.2s ease;
    }

    .flash-card:hover {
        transform: translateY(-4px);
    }

    #flash-modal {
        border: none;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    #flash-modal::backdrop {
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
    }

    #flash-modal[open] {
        animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @media (max-width: 768px) {
        #flash-modal .grid {
            grid-template-columns: 1fr;
        }

        #flash-modal img {
            max-height: 40vh !important;
        }
    }
</style>


--- src\pages\index.astro

---
import Layout from '../layouts/Layout.astro';
import { supabase } from '../lib/supabase';

// Server-Side Data Fetching for Featured Work
// This runs at build time (SSG) or request time (SSR)

// Default/fallback artworks
const defaultArtworks = [
  { src: '/images/home/h1.jpeg', title: 'Artwork 1' },
  { src: '/images/home/h2.jpeg', title: 'Artwork 2' },
  { src: '/images/home/h3.jpeg', title: 'Artwork 3' },
  { src: '/images/home/h4.jpeg', title: 'Artwork 4' },
  { src: '/images/home/h5.jpeg', title: 'Artwork 5' },
  { src: '/images/home/h6.jpeg', title: 'Artwork 6' },
];

// Try to fetch featured images from database
let artworks = defaultArtworks;

try {
  const { data: featuredImages } = await supabase
    .from('content_images')
    .select('*')
    .eq('is_featured', true)
    .order('display_order', { ascending: true });

  if (featuredImages && featuredImages.length > 0) {
    artworks = featuredImages.map((img: any) => ({
      src: img.url,
      title: img.title || 'Artwork',
      description: img.description || '',
    }));
  }
} catch (error) {
  console.error('Error fetching featured images:', error);
  // Fall back to default artworks
}
---

<Layout title="Kow Tattys | Home">
  <!-- Hero Section -->
  <section class="relative h-screen flex items-center justify-center bg-black text-white overflow-hidden">
    <canvas id="particles-canvas" class="absolute inset-0 w-full h-full"></canvas>

    <div class="relative z-20 text-center px-4">
      <h1 class="text-5xl md:text-7xl font-bold font-doto mb-6 typing-effect">
        KowTattys
      </h1>
      <p class="text-xl mb-8">Where Art Meets Skin</p>
      <button class="booking-trigger bg-primary text-primary-foreground px-8 py-3 rounded-full font-medium hover:opacity-90 transition-opacity cursor-pointer border-none">
        Book Now
      </button>
    </div>
  </section>

  <!-- Featured Artworks Gallery -->
  <section class="py-20 bg-background">
    <div class="container mx-auto px-4">
      <h2 class="text-4xl font-bold text-center mb-12 font-doto">Featured Artworks</h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {artworks.map((artwork, index) => (
          <div
            class="group relative aspect-[3/4] rounded-xl border border-black/[0.1] bg-[hsl(var(--pink-cream))] dark:bg-black dark:border-white/[0.2] hover:shadow-lg dark:hover:shadow-2xl transition-all duration-300"
            data-artwork-index={index}
          >
            <div class="absolute inset-0 p-6 sm:p-8 flex flex-col">
              <h3 class="text-xl font-semibold text-black dark:text-foreground mb-4 relative z-10">
                {artwork.title}
              </h3>

              <div class="relative flex-grow w-full h-full">
                <div class="absolute inset-0">
                  <img
                    src={artwork.src}
                    alt={artwork.title}
                    class="w-full h-full object-cover rounded-lg"
                    loading="lazy"
                  />
                  <div
                    class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg"
                  />
                </div>
              </div>

              <div class="mt-4 flex items-center justify-between relative z-10">
                <span class="text-sm text-black/70 dark:text-muted-foreground">
                  Click to view details
                </span>
                <span class="text-sm font-medium text-black dark:text-foreground">
                  →
                </span>
              </div>
            </div>

            <!-- Clickable overlay -->
            <div class="absolute inset-0 w-full h-full cursor-pointer z-20"></div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Modal -->
  <div id="artwork-modal" class="fixed inset-0 z-50 items-center justify-center bg-black/90 backdrop-blur-sm" style="display: none;">
    <div class="relative max-w-7xl max-h-[90vh] w-full mx-4">
      <button
        id="modal-close"
        class="absolute top-4 right-4 z-10 text-white hover:text-gray-300 transition-colors bg-black/50 rounded-full p-2 hover:bg-black/70"
        aria-label="Close modal"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <div class="bg-[hsl(var(--pink-cream))] rounded-lg overflow-hidden shadow-2xl dark:bg-background">
        <div class="p-6 bg-gradient-to-r from-gray-900 to-gray-800">
          <h3 id="modal-title" class="text-2xl font-bold text-white text-center font-doto"></h3>
        </div>
        <div class="flex items-center justify-center bg-gray-100 p-4 dark:bg-muted">
          <img
            id="modal-image"
            src=""
            alt=""
            class="max-w-full max-h-[70vh] object-contain rounded-lg"
          />
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Vanilla JS Particle + Shooting Star Animation
  document.addEventListener('DOMContentLoaded', () => {
    const canvas = document.getElementById('particles-canvas');
    if (!canvas || !(canvas instanceof HTMLCanvasElement)) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const dpr = window.devicePixelRatio || 1;
    const particles = [];
    const shootingStars = [];
    const mouse = { x: 0, y: 0, isPressed: false };
    const config = {
      quantity: 120,
      staticity: 50,
      ease: 50,
      baseSize: 0.4,
    };

    function resizeCanvas() {
      const { innerWidth, innerHeight } = window;
      canvas.width = innerWidth * dpr;
      canvas.height = innerHeight * dpr;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Mouse logic inspired by particles.tsx
    window.addEventListener('mousemove', (event) => {
      const rect = canvas.getBoundingClientRect();
      mouse.x = event.clientX - rect.left - rect.width / 2;
      mouse.y = event.clientY - rect.top - rect.height / 2;
    });

    window.addEventListener('mousedown', () => {
      mouse.isPressed = true;
    });
    window.addEventListener('mouseup', () => {
      mouse.isPressed = false;
    });
    window.addEventListener('touchstart', () => {
      mouse.isPressed = true;
    });
    window.addEventListener('touchend', () => {
      mouse.isPressed = false;
    });

    function remapValue(value, start1, end1, start2, end2) {
      const remapped =
        ((value - start1) * (end2 - start2)) / (end1 - start1) + start2;
      return remapped > 0 ? remapped : 0;
    }

    function createParticle() {
      const w = canvas.width / dpr;
      const h = canvas.height / dpr;
      const x = Math.random() * w;
      const y = Math.random() * h;
      const size = Math.random() * 2 + config.baseSize;

      return {
        x,
        y,
        translateX: 0,
        translateY: 0,
        size,
        alpha: 0,
        targetAlpha: +(Math.random() * 0.6 + 0.1).toFixed(1),
        dx: (Math.random() - 0.5) * 0.1,
        dy: (Math.random() - 0.5) * 0.1,
        magnetism: 0.1 + Math.random() * 4,
      };
    }

    function initParticles() {
      particles.length = 0;
      for (let i = 0; i < config.quantity; i++) {
        particles.push(createParticle());
      }
    }

    // Shooting star logic inspired by shooting-star.tsx
    function generateStartPosition() {
      const edge = Math.floor(Math.random() * 3);
      let startX, startY, angle;

      switch (edge) {
        case 0: // top
          startX = Math.random() * window.innerWidth;
          startY = -20;
          angle = 30 + Math.random() * 30;
          break;
        case 1: // left
          startX = -20;
          startY = Math.random() * (window.innerHeight / 2);
          angle = 15 + Math.random() * 30;
          break;
        case 2: // right
        default:
          startX = window.innerWidth + 20;
          startY = Math.random() * (window.innerHeight / 2);
          angle = 195 + Math.random() * 30;
          break;
      }

      return { startX, startY, angle };
    }

    function createShootingStar(forceComet = false) {
      const { startX, startY, angle } = generateStartPosition();
      const isComet = forceComet || Math.random() < 0.2;
      const baseSize = isComet ? 5 + Math.random() * 2 : 2 + Math.random() * 2;
      // Treat "speed" as the travel duration in seconds, like in shooting-star.tsx
      const duration = isComet ? 4 + Math.random() : 3.2 + Math.random() * 0.6;

      const distance = Math.max(window.innerWidth, window.innerHeight) * 1.5;
      const angleRad = (angle * Math.PI) / 180;
      const totalFrames = duration * 60; // approx 60fps
      const vx = (Math.cos(angleRad) * distance) / totalFrames;
      const vy = (Math.sin(angleRad) * distance) / totalFrames;

      return {
        x: startX,
        y: startY,
        size: baseSize,
        angle,
        duration,
        vx,
        vy,
        life: 0,
        maxLife: totalFrames,
        isComet,
      };
    }

    function updateParticles() {
      const w = canvas.width / dpr;
      const h = canvas.height / dpr;

      particles.forEach((p, i) => {
        const edge = [
          p.x + p.translateX - p.size,
          w - p.x - p.translateX - p.size,
          p.y + p.translateY - p.size,
          h - p.y - p.translateY - p.size,
        ];
        const closestEdge = edge.reduce((a, b) => Math.min(a, b));
        const remapClosestEdge = +remapValue(closestEdge, 0, 20, 0, 1).toFixed(
          2
        );

        if (mouse.isPressed) {
          const dx = p.x - mouse.x - w / 2;
          const dy = p.y - mouse.y - h / 2;
          const distance = Math.sqrt(dx * dx + dy * dy) || 1;
          const force = Math.max(100 - distance, 0) / 10;
          p.dx += (dx / distance) * force * 0.2;
          p.dy += (dy / distance) * force * 0.2;
        }

        p.dx *= 0.95;
        p.dy *= 0.95;
        p.x += p.dx;
        p.y += p.dy;

        if (remapClosestEdge > 1) {
          p.alpha += 0.02;
          if (p.alpha > p.targetAlpha) p.alpha = p.targetAlpha;
        } else {
          p.alpha = p.targetAlpha * remapClosestEdge;
        }

        const magnetism = mouse.isPressed ? p.magnetism * 0.5 : p.magnetism;
        p.translateX +=
          (mouse.x / (config.staticity / magnetism) - p.translateX) /
          config.ease;
        p.translateY +=
          (mouse.y / (config.staticity / magnetism) - p.translateY) /
          config.ease;

        if (
          p.x < -p.size ||
          p.x > w + p.size ||
          p.y < -p.size ||
          p.y > h + p.size
        ) {
          particles[i] = createParticle();
        }
      });
    }

    function updateShootingStars() {
      if (Math.random() < 0.035) {
        shootingStars.push(createShootingStar());
      }

      const w = canvas.width / dpr;
      const h = canvas.height / dpr;

      for (let i = shootingStars.length - 1; i >= 0; i--) {
        const s = shootingStars[i];
        s.x += s.vx;
        s.y += s.vy;
        // life is measured in frames, aligned with maxLife
        s.life += 1;

        if (
          s.x < -100 ||
          s.x > w + 100 ||
          s.y < -100 ||
          s.y > h + 100 ||
          s.life > s.maxLife
        ) {
          shootingStars.splice(i, 1);
        }
      }
    }

    function drawParticles() {
      particles.forEach((p) => {
        ctx.save();
        ctx.translate(p.translateX, p.translateY);
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${p.alpha})`;
        ctx.fill();
        ctx.restore();
      });
    }

    function drawShootingStars() {
      shootingStars.forEach((s) => {
        const alpha = 1 - s.life / s.maxLife;

        // main body
        ctx.save();
        ctx.translate(s.x, s.y);
        ctx.rotate((s.angle * Math.PI) / 180);

        const gradient = ctx.createLinearGradient(0, 0, -150, 0);
        if (s.isComet) {
          gradient.addColorStop(0, `rgba(255, 255, 255, ${alpha})`);
          gradient.addColorStop(0.4, `rgba(255, 215, 0, ${alpha * 0.6})`);
          gradient.addColorStop(1, `rgba(255, 69, 0, 0)`);
        } else {
          gradient.addColorStop(0, `rgba(255, 255, 255, ${alpha})`);
          gradient.addColorStop(0.4, `rgba(255, 255, 255, ${alpha * 0.5})`);
          gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
        }

        // head
        ctx.beginPath();
        ctx.arc(0, 0, s.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
        ctx.shadowColor = 'rgba(255,255,255,0.8)';
        ctx.shadowBlur = s.isComet ? 12 : 6;
        ctx.fill();

        // tail
        ctx.beginPath();
        ctx.moveTo(0, -s.size / 2);
        ctx.lineTo(-150, 0);
        ctx.lineTo(0, s.size / 2);
        ctx.closePath();
        ctx.fillStyle = gradient;
        ctx.fill();

        ctx.restore();
      });
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      updateParticles();
      updateShootingStars();
      drawParticles();
      drawShootingStars();
      requestAnimationFrame(animate);
    }

    initParticles();
    animate();
  });

  // Artwork Modal Functionality
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('artwork-modal');
    const modalImage = document.getElementById('modal-image') as HTMLImageElement | null;
    const modalTitle = document.getElementById('modal-title');
    const closeButton = document.getElementById('modal-close');

    const artworks = [
      { src: '/images/home/h1.jpeg', title: 'Artwork 1' },
      { src: '/images/home/h2.jpeg', title: 'Artwork 2' },
      { src: '/images/home/h3.jpeg', title: 'Artwork 3' },
      { src: '/images/home/h4.jpeg', title: 'Artwork 4' },
      { src: '/images/home/h5.jpeg', title: 'Artwork 5' },
      { src: '/images/home/h6.jpeg', title: 'Artwork 6' },
    ];

    if (!modal || !modalImage || !modalTitle) {
      console.error('Modal elements not found');
      return;
    }

    // Open modal when artwork is clicked
    const artworkOverlays = document.querySelectorAll('.absolute.inset-0.w-full.h-full.cursor-pointer');
    artworkOverlays.forEach((overlay, index) => {
      overlay.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const artwork = artworks[index];

        if (artwork) {
          modalImage.src = artwork.src;
          modalImage.alt = artwork.title;
          modalTitle.textContent = artwork.title;
          // Use inline style to ensure display works
          modal.style.display = 'flex';
          document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }
      });
    });

    // Close modal functions
    const closeModal = () => {
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = ''; // Restore scrolling
      }
    };

    if (closeButton) {
      closeButton.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        closeModal();
      });
    }

    // Close modal when clicking outside the image
    if (modal) {
      modal.addEventListener('click', (e) => {
        // Only close if clicking directly on the modal backdrop, not on child elements
        if (e.target === modal) {
          closeModal();
        }
      });
    }

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal && modal.style.display !== 'none') {
        closeModal();
      }
    });
  });
</script>

<style>
  /* CSS Typewriter substitute */
  .typing-effect {
    overflow: hidden;
    border-right: .15em solid orange;
    white-space: nowrap;
    animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
  }

  @keyframes typing {
    from { width: 0 }
    to { width: 100% }
  }

  @keyframes blink-caret {
    from, to { border-color: transparent }
    50% { border-color: orange; }
  }

  /* Modal animations */
  #artwork-modal {
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  #modal-image {
    animation: zoomIn 0.3s ease-out;
  }

  @keyframes zoomIn {
    from {
      transform: scale(0.9);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
</style>


--- src\pages\policy.astro

---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";

// Fetch policy text from site_settings
let policyContent = "";

try {
    const { data } = await supabase
        .from("site_settings")
        .select("value")
        .eq("key", "policy_text")
        .single();

    policyContent = data?.value || "";
} catch (error) {
    console.error("Error fetching policy text:", error);
}

// Default content if nothing in database
const defaultContent = `
# Studio Policies & Terms

Welcome to KowTattys! Please read through our policies carefully before booking your appointment. These guidelines help ensure a safe, professional, and enjoyable experience for everyone.

## Booking & Deposits

- A **non-refundable deposit** is required to secure your appointment
- Deposits range from $50-$200 depending on the size and complexity of your tattoo
- Your deposit will be applied to the final cost of your tattoo
- Deposits are forfeited if you cancel within 48 hours of your appointment

## Rescheduling Policy

- Please provide at least **48 hours notice** if you need to reschedule
- Rescheduling with less than 48 hours notice may result in loss of your deposit
- You may reschedule up to 2 times before a new deposit is required
- We understand emergencies happen - please communicate with us

## Day of Your Appointment

### Preparation
- Get a good night's sleep before your appointment
- Eat a substantial meal 1-2 hours before your session
- Stay hydrated - drink plenty of water the day before and day of
- Avoid alcohol for at least 24 hours before your appointment
- Avoid blood thinners (aspirin, ibuprofen) for 24 hours prior

### What to Bring
- Valid government-issued photo ID
- Your reference images (if not already submitted)
- Comfortable clothing that allows access to the tattoo area
- Snacks and drinks for longer sessions
- Entertainment (phone, book, etc.) for extended sessions

### Health Requirements
- You must be **18 years or older** with valid ID
- Inform us of any medical conditions, allergies, or medications
- We cannot tattoo if you are pregnant or nursing
- If you are sick, please reschedule your appointment
- No tattoos if you have sunburn in the area to be tattooed

## During Your Session

- One support person is allowed; additional guests require approval
- Please silence your phone during the tattoo process
- Let your artist know if you need a break at any time
- Communicate openly about your comfort level

## Pricing

- Prices are determined based on size, detail, placement, and time
- Minimum charge is **$100** for any tattoo
- Larger pieces may be quoted as a flat rate or hourly rate
- Touch-ups within 3 months are free (if aftercare instructions were followed)
- Cover-ups and reworks are priced on a case-by-case basis

## Aftercare

- You will receive detailed aftercare instructions after your session
- Follow all aftercare instructions carefully for optimal healing
- Healing typically takes 2-4 weeks
- Avoid swimming, sun exposure, and soaking for 2-3 weeks
- Contact us immediately if you notice signs of infection

## Refund Policy

- Deposits are non-refundable
- We do not offer refunds on completed tattoos
- If you are unhappy with your tattoo, please contact us to discuss options
- Free touch-ups are available within 3 months for any healing issues

## Our Commitment

We are committed to providing:
- A clean, sterile, and safe environment
- High-quality, professional tattooing
- Clear communication throughout your experience
- Respect for your time, ideas, and concerns

## Contact Us

If you have any questions about our policies, please don't hesitate to reach out before your appointment. We're happy to address any concerns you may have.

---

*Last updated: January 2024*
`;

const displayContent = policyContent || defaultContent;

// Simple markdown-like parsing
function parseContent(content: string) {
    return content
        .split('\n')
        .map(line => {
            // Horizontal rule
            if (line.trim() === '---') {
                return '<hr class="my-8 border-gray-300 dark:border-gray-600" />';
            }
            // Headers
            if (line.startsWith('### ')) {
                return `<h3 class="text-xl font-bold mt-6 mb-3 font-doto text-gray-900 dark:text-white">${line.slice(4)}</h3>`;
            }
            if (line.startsWith('## ')) {
                return `<h2 class="text-2xl font-bold mt-8 mb-4 font-doto text-gray-900 dark:text-white">${line.slice(3)}</h2>`;
            }
            if (line.startsWith('# ')) {
                return `<h1 class="text-4xl font-bold mb-6 font-doto text-gray-900 dark:text-white">${line.slice(2)}</h1>`;
            }
            // Bold text
            line = line.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-900 dark:text-white">$1</strong>');
            // Italic text
            line = line.replace(/\*(.*?)\*/g, '<em>$1</em>');
            // List items
            if (line.startsWith('- ')) {
                return `<li class="ml-4 mb-2 text-gray-700 dark:text-gray-300">${line.slice(2)}</li>`;
            }
            // Empty lines
            if (line.trim() === '') {
                return '<br />';
            }
            // Regular paragraphs
            return `<p class="mb-4 text-gray-700 dark:text-gray-300">${line}</p>`;
        })
        .join('\n');
}
---

<Layout title="Policies & Terms | KowTattys">
    <div class="container mx-auto px-4 py-12 max-w-4xl">
        <!-- Hero Section -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold font-doto mb-4">Policies & Terms</h1>
            <p class="text-xl text-muted-foreground">
                Everything you need to know before your appointment
            </p>
        </div>

        <!-- Main Content -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8 md:p-12">
            <article class="prose dark:prose-invert max-w-none">
                <Fragment set:html={parseContent(displayContent)} />
            </article>
        </div>

        <!-- Quick Links -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
            <a
                href="/contact"
                class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow group"
            >
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg group-hover:bg-purple-200 dark:group-hover:bg-purple-900/50 transition-colors">
                        <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900 dark:text-white">Contact Us</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Have questions?</p>
                    </div>
                </div>
            </a>

            <button
                class="booking-trigger bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow group text-left"
            >
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-lg group-hover:bg-green-200 dark:group-hover:bg-green-900/50 transition-colors">
                        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900 dark:text-white">Book Now</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Ready to get inked?</p>
                    </div>
                </div>
            </button>

            <a
                href="/flash-designs"
                class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow group"
            >
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg group-hover:bg-blue-200 dark:group-hover:bg-blue-900/50 transition-colors">
                        <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900 dark:text-white">Flash Designs</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Browse our collection</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Back to Home -->
        <div class="text-center mt-8">
            <a href="/" class="text-purple-600 hover:underline">
                ← Back to Homepage
            </a>
        </div>
    </div>
</Layout>

<style>
    article h1 {
        @apply text-4xl font-bold mb-6;
    }

    article h2 {
        @apply text-2xl font-bold mt-8 mb-4;
    }

    article h3 {
        @apply text-xl font-bold mt-6 mb-3;
    }

    article p {
        @apply mb-4;
    }

    article ul {
        @apply list-disc list-inside mb-4;
    }

    article li {
        @apply mb-2;
    }
</style>


--- src\pages\portfolio.astro

---
import Layout from "../layouts/Layout.astro";
import CircularGallery from "../components/CircularGallery.jsx";
import { supabase } from "../lib/supabase";

// Default/fallback portfolio data
const defaultPortfolioData = [
    {
        image: "/images/portfolio/boondocks.png",
        text: "Boondocks Portrait",
        description:
            "A vibrant tribute to the iconic Boondocks animated series, featuring detailed linework and rich color saturation.",
    },
    {
        image: "/images/portfolio/dragon.png",
        text: "Dragon Design",
        description:
            "A powerful dragon tattoo featuring intricate scales and dynamic movement, crafted with precision shading.",
    },
    {
        image: "/images/portfolio/frsnchise.png",
        text: "Franchise Piece",
        description:
            "Bold artistic expression with clean lines and creative composition, representing personal style and identity.",
    },
    {
        image: "/images/portfolio/luvers.png",
        text: "Lovers Art",
        description:
            "An emotional piece capturing connection and intimacy through flowing artistic design and subtle color gradients.",
    },
    {
        image: "/images/portfolio/naruto.png",
        text: "Naruto Tribute",
        description:
            "A dynamic anime-inspired tattoo featuring the legendary ninja, showcasing vibrant colors and action-packed composition.",
    },
];

// Try to fetch portfolio images from database
let portfolioData = defaultPortfolioData;

try {
    const { data: portfolioImages } = await supabase
        .from("content_images")
        .select("*")
        .eq("category", "portfolio")
        .order("display_order", { ascending: true });

    if (portfolioImages && portfolioImages.length > 0) {
        portfolioData = portfolioImages.map((img: any) => ({
            image: img.url,
            text: img.title || "Artwork",
            description: img.description || "",
        }));
    }
} catch (error) {
    console.error("Error fetching portfolio images:", error);
    // Fall back to default portfolio data
}
---

<Layout title="Portfolio">
    <div class="container mx-auto px-4 py-12">
        <h1 class="text-5xl font-bold text-center mb-12 font-doto">
            Portfolio
        </h1>

        <!-- Circular Gallery Container -->
        <div id="gallery-container" class="gallery-wrapper">
            <CircularGallery
                client:only="react"
                items={portfolioData}
                bend={2.5}
                textColor="#ffffff"
                borderRadius={0.08}
                font="bold 28px Doto"
                scrollSpeed={2}
                scrollEase={0.07}
            />
            <div class="gallery-instructions">Scroll or drag to explore</div>
        </div>
    </div>

    <!-- Modal for Portfolio Details -->
    <dialog
        id="portfolio-modal"
        class="backdrop:bg-black/80 rounded-lg p-0 bg-background max-w-4xl w-full max-h-[90vh]"
    >
        <div class="relative">
            <button
                id="close-modal"
                class="absolute top-4 right-4 z-10 p-2 bg-black/50 text-white rounded-full hover:bg-black/70 transition-colors"
                >✕</button
            >
            <div class="grid md:grid-cols-2">
                <div class="bg-black flex items-center justify-center">
                    <img
                        id="modal-image"
                        src=""
                        alt=""
                        class="max-h-[60vh] md:max-h-full w-auto object-contain"
                    />
                </div>
                <div class="p-8">
                    <h2
                        id="modal-title"
                        class="text-2xl font-bold mb-4 font-doto"
                    >
                    </h2>
                    <p id="modal-desc" class="text-muted-foreground"></p>
                </div>
            </div>
        </div>
    </dialog>
</Layout>

<script>
    // Modal functionality
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById(
            "portfolio-modal",
        ) as HTMLDialogElement;
        const closeBtn = document.getElementById("close-modal");
        const modalImg = document.getElementById(
            "modal-image",
        ) as HTMLImageElement;
        const modalTitle = document.getElementById("modal-title");
        const modalDesc = document.getElementById("modal-desc");

        // Close modal on button click
        closeBtn?.addEventListener("click", () => modal.close());

        // Close on backdrop click
        modal.addEventListener("click", (e) => {
            const rect = modal.getBoundingClientRect();
            if (
                e.clientX < rect.left ||
                e.clientX > rect.right ||
                e.clientY < rect.top ||
                e.clientY > rect.bottom
            ) {
                modal.close();
            }
        });

        // Close on Escape key
        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal.open) {
                modal.close();
            }
        });

        // Listen for custom event from gallery items
        window.addEventListener("openPortfolioModal", ((e: CustomEvent) => {
            const { image, text, description } = e.detail;
            if (modalImg) modalImg.src = image || "";
            if (modalTitle) modalTitle.textContent = text || "";
            if (modalDesc) modalDesc.textContent = description || "";
            modal.showModal();
        }) as EventListener);
    });
</script>

<style>
    .gallery-wrapper {
        position: relative;
        height: 80vh;
        min-height: 500px;
        width: 100%;
    }

    .gallery-wrapper :global(.circular-gallery) {
        width: 100%;
        height: 100%;
    }
</style>


--- src\pages\admin\index.astro

---
import AdminLayout from "../../layouts/AdminLayout.astro";
import { supabase } from "../../lib/supabase";

// Fetch booking statistics
let pendingCount = 0;
let acceptedCount = 0;
let deniedCount = 0;
let totalBookings = 0;
let recentBookings: any[] = [];

try {
    // Get counts by status
    const { count: pending } = await supabase
        .from("bookings")
        .select("*", { count: "exact", head: true })
        .eq("status", "pending");

    const { count: accepted } = await supabase
        .from("bookings")
        .select("*", { count: "exact", head: true })
        .eq("status", "accepted");

    const { count: denied } = await supabase
        .from("bookings")
        .select("*", { count: "exact", head: true })
        .eq("status", "denied");

    pendingCount = pending || 0;
    acceptedCount = accepted || 0;
    deniedCount = denied || 0;
    totalBookings = pendingCount + acceptedCount + deniedCount;

    // Get recent bookings
    const { data: recent } = await supabase
        .from("bookings")
        .select("*")
        .order("created_at", { ascending: false })
        .limit(5);

    recentBookings = recent || [];
} catch (error) {
    console.error("Error fetching dashboard data:", error);
}

// Format date helper
function formatDate(dateString: string) {
    return new Date(dateString).toLocaleDateString("en-US", {
        month: "short",
        day: "numeric",
        year: "numeric",
    });
}

function getStatusColor(status: string) {
    switch (status) {
        case "pending":
            return "bg-yellow-100 text-yellow-800";
        case "accepted":
            return "bg-green-100 text-green-800";
        case "denied":
            return "bg-red-100 text-red-800";
        default:
            return "bg-gray-100 text-gray-800";
    }
}
---

<AdminLayout title="Dashboard">
    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Bookings -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">
                        Total Bookings
                    </p>
                    <p class="text-3xl font-bold text-gray-900 dark:text-white mt-1">
                        {totalBookings}
                    </p>
                </div>
                <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-full">
                    <svg
                        class="w-6 h-6 text-purple-600 dark:text-purple-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                        ></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Pending -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">
                        Pending
                    </p>
                    <p class="text-3xl font-bold text-yellow-600 mt-1">
                        {pendingCount}
                    </p>
                </div>
                <div class="p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-full">
                    <svg
                        class="w-6 h-6 text-yellow-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Accepted -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">
                        Accepted
                    </p>
                    <p class="text-3xl font-bold text-green-600 mt-1">
                        {acceptedCount}
                    </p>
                </div>
                <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-full">
                    <svg
                        class="w-6 h-6 text-green-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Denied -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">
                        Denied
                    </p>
                    <p class="text-3xl font-bold text-red-600 mt-1">
                        {deniedCount}
                    </p>
                </div>
                <div class="p-3 bg-red-100 dark:bg-red-900/30 rounded-full">
                    <svg
                        class="w-6 h-6 text-red-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Bookings -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                Recent Bookings
            </h2>
            <a
                href="/admin/bookings"
                class="text-sm text-purple-600 hover:text-purple-700 font-medium"
            >
                View All →
            </a>
        </div>

        {
            recentBookings.length > 0 ? (
                <div class="divide-y divide-gray-200 dark:divide-gray-700">
                    {recentBookings.map((booking) => (
                        <a
                            href={`/admin/bookings/${booking.id}`}
                            class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"
                        >
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center">
                                    <span class="text-purple-600 dark:text-purple-400 font-semibold">
                                        {booking.first_name?.[0]?.toUpperCase()}
                                        {booking.last_name?.[0]?.toUpperCase()}
                                    </span>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">
                                        {booking.first_name} {booking.last_name}
                                    </p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">
                                        {booking.tattoo_idea?.substring(0, 50)}
                                        {booking.tattoo_idea?.length > 50
                                            ? "..."
                                            : ""}
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span
                                    class={`px-3 py-1 rounded-full text-xs font-medium capitalize ${getStatusColor(booking.status)}`}
                                >
                                    {booking.status}
                                </span>
                                <span class="text-sm text-gray-500 dark:text-gray-400">
                                    {formatDate(booking.created_at)}
                                </span>
                            </div>
                        </a>
                    ))}
                </div>
            ) : (
                <div class="px-6 py-12 text-center">
                    <svg
                        class="w-12 h-12 mx-auto text-gray-400 mb-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                        />
                    </svg>
                    <p class="text-gray-500 dark:text-gray-400">
                        No bookings yet
                    </p>
                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">
                        Bookings will appear here when clients submit requests
                    </p>
                </div>
            )
        }
    </div>

    <!-- Quick Actions -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
        <a
            href="/admin/bookings"
            class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow group"
        >
            <div class="flex items-center gap-4">
                <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg group-hover:bg-purple-200 dark:group-hover:bg-purple-900/50 transition-colors">
                    <svg
                        class="w-6 h-6 text-purple-600 dark:text-purple-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                    </svg>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 dark:text-white">
                        Manage Bookings
                    </h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Review and respond to requests
                    </p>
                </div>
            </div>
        </a>

        <a
            href="/admin/cms"
            class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow group"
        >
            <div class="flex items-center gap-4">
                <div class="p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg group-hover:bg-blue-200 dark:group-hover:bg-blue-900/50 transition-colors">
                    <svg
                        class="w-6 h-6 text-blue-600 dark:text-blue-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                    </svg>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 dark:text-white">
                        Update Content
                    </h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        Manage images and text
                    </p>
                </div>
            </div>
        </a>

        <a
            href="/"
            target="_blank"
            class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow group"
        >
            <div class="flex items-center gap-4">
                <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-lg group-hover:bg-green-200 dark:group-hover:bg-green-900/50 transition-colors">
                    <svg
                        class="w-6 h-6 text-green-600 dark:text-green-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                        ></path>
                    </svg>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 dark:text-white">
                        View Website
                    </h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        See the public site
                    </p>
                </div>
            </div>
        </a>
    </div>
</AdminLayout>


--- src\pages\admin\login.astro

---
import "../../styles/global.css";
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>Admin Login | KowTattys</title>
        <meta name="robots" content="noindex, nofollow" />
    </head>
    <body class="bg-gray-900 min-h-screen flex items-center justify-center p-4">
        <!-- Check if already logged in -->
        <script>
            import { supabase } from "../../lib/supabase";

            async function checkExistingSession() {
                const {
                    data: { session },
                } = await supabase.auth.getSession();

                if (session) {
                    // Sync cookies for SSR support
                    const { access_token, refresh_token } = session;
                    const expiration = 60 * 60 * 24 * 7; // 7 days
                    document.cookie = `sb-access-token=${access_token}; path=/; max-age=${expiration}; SameSite=Lax; secure`;
                    document.cookie = `sb-refresh-token=${refresh_token}; path=/; max-age=${expiration}; SameSite=Lax; secure`;

                    window.location.href = "/admin";
                }
            }

            checkExistingSession();
        </script>

        <div class="w-full max-w-md">
            <!-- Logo -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white font-doto">
                    KowTattys
                </h1>
                <p class="text-gray-400 mt-2">Admin Portal</p>
            </div>

            <!-- Login Card -->
            <div class="bg-gray-800 rounded-xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-white mb-6">Sign In</h2>

                <!-- Error Message -->
                <div
                    id="error-message"
                    class="hidden mb-4 p-4 bg-red-500/10 border border-red-500/50 rounded-lg text-red-400 text-sm"
                >
                </div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label
                            for="email"
                            class="block text-sm font-medium text-gray-300 mb-2"
                        >
                            Email
                        </label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                            placeholder="admin@kowtattys.com"
                        />
                    </div>

                    <div>
                        <label
                            for="password"
                            class="block text-sm font-medium text-gray-300 mb-2"
                        >
                            Password
                        </label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                            class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                            placeholder="••••••••"
                        />
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        <span id="btn-text">Sign In</span>
                        <span id="btn-loading" class="hidden">
                            <svg
                                class="animate-spin h-5 w-5 mx-auto"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                            >
                                <circle
                                    class="opacity-25"
                                    cx="12"
                                    cy="12"
                                    r="10"
                                    stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path
                                    class="opacity-75"
                                    fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                ></path>
                            </svg>
                        </span>
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <a
                        href="/"
                        class="text-sm text-gray-400 hover:text-white transition-colors"
                    >
                        ← Back to Website
                    </a>
                </div>
            </div>

            <!-- Security Notice -->
            <p class="text-center text-gray-500 text-xs mt-6">
                This is a secure admin area. Unauthorized access is prohibited.
            </p>
        </div>

        <script>
            import { supabase } from "../../lib/supabase";

            const form = document.getElementById(
                "login-form",
            ) as HTMLFormElement;
            const errorMessage = document.getElementById("error-message");
            const submitBtn = document.getElementById(
                "submit-btn",
            ) as HTMLButtonElement;
            const btnText = document.getElementById("btn-text");
            const btnLoading = document.getElementById("btn-loading");

            function showError(message: string) {
                if (errorMessage) {
                    errorMessage.textContent = message;
                    errorMessage.classList.remove("hidden");
                }
            }

            function hideError() {
                if (errorMessage) {
                    errorMessage.classList.add("hidden");
                }
            }

            function setLoading(loading: boolean) {
                if (submitBtn && btnText && btnLoading) {
                    submitBtn.disabled = loading;
                    btnText.classList.toggle("hidden", loading);
                    btnLoading.classList.toggle("hidden", !loading);
                }
            }

            form?.addEventListener("submit", async (e) => {
                e.preventDefault();
                hideError();
                setLoading(true);

                const formData = new FormData(form);
                const email = formData.get("email") as string;
                const password = formData.get("password") as string;

                try {
                    const { data, error } =
                        await supabase.auth.signInWithPassword({
                            email,
                            password,
                        });

                    if (error) {
                        showError(error.message);
                        setLoading(false);
                        return;
                    }

                    if (data.session) {
                        // Set session cookies for SSR support
                        const { access_token, refresh_token } = data.session;
                        const expiration = 60 * 60 * 24 * 7; // 7 days
                        document.cookie = `sb-access-token=${access_token}; path=/; max-age=${expiration}; SameSite=Lax; secure`;
                        document.cookie = `sb-refresh-token=${refresh_token}; path=/; max-age=${expiration}; SameSite=Lax; secure`;

                        window.location.href = "/admin";
                    }
                } catch (err) {
                    showError(
                        "An unexpected error occurred. Please try again.",
                    );
                    setLoading(false);
                }
            });
        </script>

        <style>
            @import url("https://fonts.googleapis.com/css2?family=Doto:wght@100..900&display=swap");

            .font-doto {
                font-family: "Doto", sans-serif;
            }
        </style>
    </body>
</html>


--- src\pages\admin\bookings\index.astro

---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { supabase } from "../../../lib/supabase";

// Fetch all bookings
let bookings: any[] = [];
let error = null;

try {
    const { data, error: fetchError } = await supabase
        .from("bookings")
        .select("*")
        .order("created_at", { ascending: false });

    if (fetchError) throw fetchError;
    bookings = data || [];
} catch (e) {
    console.error("Error fetching bookings:", e);
    error = e;
}

// Group bookings by status
const pendingBookings = bookings.filter((b) => b.status === "pending");
const acceptedBookings = bookings.filter((b) => b.status === "accepted");
const deniedBookings = bookings.filter((b) => b.status === "denied");

// Format date helper
function formatDate(dateString: string) {
    return new Date(dateString).toLocaleDateString("en-US", {
        month: "short",
        day: "numeric",
        year: "numeric",
        hour: "numeric",
        minute: "2-digit",
    });
}

function getStatusColor(status: string) {
    switch (status) {
        case "pending":
            return "bg-yellow-100 text-yellow-800 border-yellow-200";
        case "accepted":
            return "bg-green-100 text-green-800 border-green-200";
        case "denied":
            return "bg-red-100 text-red-800 border-red-200";
        default:
            return "bg-gray-100 text-gray-800 border-gray-200";
    }
}
---

<AdminLayout title="Bookings">
    <!-- Filter Tabs -->
    <div class="mb-6">
        <div class="flex gap-2 flex-wrap">
            <button
                data-filter="all"
                class="filter-btn active px-4 py-2 rounded-lg font-medium transition-colors bg-purple-600 text-white"
            >
                All ({bookings.length})
            </button>
            <button
                data-filter="pending"
                class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
            >
                Pending ({pendingBookings.length})
            </button>
            <button
                data-filter="accepted"
                class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
            >
                Accepted ({acceptedBookings.length})
            </button>
            <button
                data-filter="denied"
                class="filter-btn px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"
            >
                Denied ({deniedBookings.length})
            </button>
        </div>
    </div>

    {
        error ? (
            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 text-center">
                <p class="text-red-600 dark:text-red-400">
                    Error loading bookings. Please try again.
                </p>
            </div>
        ) : bookings.length === 0 ? (
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 text-center">
                <svg
                    class="w-16 h-16 mx-auto text-gray-400 mb-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                </svg>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                    No Bookings Yet
                </h3>
                <p class="text-gray-500 dark:text-gray-400">
                    When clients submit booking requests, they'll appear here.
                </p>
            </div>
        ) : (
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-gray-700/50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Client
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Tattoo Idea
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Size / Placement
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Status
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Date
                                </th>
                                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            {bookings.map((booking) => (
                                <tr
                                    class="booking-row hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors"
                                    data-status={booking.status}
                                >
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                                                <span class="text-purple-600 dark:text-purple-400 font-semibold text-sm">
                                                    {booking.first_name?.[0]?.toUpperCase()}
                                                    {booking.last_name?.[0]?.toUpperCase()}
                                                </span>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white">
                                                    {booking.first_name}{" "}
                                                    {booking.last_name}
                                                </p>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                                    {booking.email}
                                                </p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-gray-900 dark:text-white max-w-xs truncate">
                                            {booking.tattoo_idea}
                                        </p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <p class="text-gray-900 dark:text-white">
                                            {booking.tattoo_size}
                                        </p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            {booking.tattoo_placement}
                                        </p>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span
                                            class={`inline-flex px-3 py-1 rounded-full text-xs font-medium capitalize border ${getStatusColor(booking.status)}`}
                                        >
                                            {booking.status}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap">
                                        {formatDate(booking.created_at)}
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="flex items-center justify-end gap-2">
                                            {booking.status === "pending" && (
                                                <>
                                                    <button
                                                        class="action-btn accept-btn p-2 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors"
                                                        data-id={booking.id}
                                                        title="Accept"
                                                    >
                                                        <svg
                                                            class="w-5 h-5"
                                                            fill="none"
                                                            stroke="currentColor"
                                                            viewBox="0 0 24 24"
                                                        >
                                                            <path
                                                                stroke-linecap="round"
                                                                stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M5 13l4 4L19 7"
                                                            />
                                                        </svg>
                                                    </button>
                                                    <button
                                                        class="action-btn deny-btn p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors"
                                                        data-id={booking.id}
                                                        title="Deny"
                                                    >
                                                        <svg
                                                            class="w-5 h-5"
                                                            fill="none"
                                                            stroke="currentColor"
                                                            viewBox="0 0 24 24"
                                                        >
                                                            <path
                                                                stroke-linecap="round"
                                                                stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M6 18L18 6M6 6l12 12"
                                                            />
                                                        </svg>
                                                    </button>
                                                </>
                                            )}
                                            <a
                                                href={`/admin/bookings/${booking.id}`}
                                                class="p-2 text-purple-600 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors"
                                                title="View Details"
                                            >
                                                <svg
                                                    class="w-5 h-5"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                                    />
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                                                    />
                                                </svg>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        )
    }

    <!-- Status Update Modal -->
    <dialog
        id="status-modal"
        class="fixed inset-0 z-50 bg-transparent p-4"
    >
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-auto mt-20 p-6">
            <h3 id="modal-title" class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                Update Booking Status
            </h3>
            <p id="modal-description" class="text-gray-600 dark:text-gray-400 mb-6">
                Are you sure you want to update this booking?
            </p>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Admin Notes (Optional)
                </label>
                <textarea
                    id="admin-notes"
                    rows="3"
                    class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Add any notes about this booking..."
                ></textarea>
            </div>

            <div class="flex justify-end gap-3">
                <button
                    id="modal-cancel"
                    class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
                >
                    Cancel
                </button>
                <button
                    id="modal-confirm"
                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                    Confirm
                </button>
            </div>
        </div>
    </dialog>

    <!-- Client Link Modal -->
    <dialog
        id="link-modal"
        class="fixed inset-0 z-50 bg-transparent p-4"
    >
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full mx-auto mt-20 p-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="p-2 bg-green-100 dark:bg-green-900/30 rounded-full">
                    <svg
                        class="w-6 h-6 text-green-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">
                    Booking Accepted!
                </h3>
            </div>

            <p class="text-gray-600 dark:text-gray-400 mb-4">
                Share this link with the client so they can view their booking status and chat with you:
            </p>

            <div class="flex gap-2 mb-6">
                <input
                    id="client-link"
                    type="text"
                    readonly
                    class="flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white text-sm"
                />
                <button
                    id="copy-link"
                    class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2"
                >
                    <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                        ></path>
                    </svg>
                    Copy
                </button>
            </div>

            <div class="flex justify-end">
                <button
                    id="link-modal-close"
                    class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                >
                    Done
                </button>
            </div>
        </div>
    </dialog>
</AdminLayout>

<script>
    import { supabase } from "../../../lib/supabase";

    // Filter functionality
    const filterBtns = document.querySelectorAll(".filter-btn");
    const bookingRows = document.querySelectorAll(".booking-row");

    filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            const filter = btn.getAttribute("data-filter");

            // Update active state
            filterBtns.forEach((b) => {
                b.classList.remove(
                    "active",
                    "bg-purple-600",
                    "text-white",
                );
                b.classList.add(
                    "bg-gray-200",
                    "dark:bg-gray-700",
                    "text-gray-700",
                    "dark:text-gray-300",
                );
            });
            btn.classList.add("active", "bg-purple-600", "text-white");
            btn.classList.remove(
                "bg-gray-200",
                "dark:bg-gray-700",
                "text-gray-700",
                "dark:text-gray-300",
            );

            // Filter rows
            bookingRows.forEach((row) => {
                const status = row.getAttribute("data-status");
                if (filter === "all" || status === filter) {
                    (row as HTMLElement).style.display = "";
                } else {
                    (row as HTMLElement).style.display = "none";
                }
            });
        });
    });

    // Status update modal
    const statusModal = document.getElementById("status-modal") as HTMLDialogElement;
    const modalTitle = document.getElementById("modal-title");
    const modalDescription = document.getElementById("modal-description");
    const modalCancel = document.getElementById("modal-cancel");
    const modalConfirm = document.getElementById("modal-confirm");
    const adminNotes = document.getElementById("admin-notes") as HTMLTextAreaElement;

    // Link modal
    const linkModal = document.getElementById("link-modal") as HTMLDialogElement;
    const clientLinkInput = document.getElementById("client-link") as HTMLInputElement;
    const copyLinkBtn = document.getElementById("copy-link");
    const linkModalClose = document.getElementById("link-modal-close");

    let currentBookingId: string | null = null;
    let currentAction: "accept" | "deny" | null = null;

    // Accept buttons
    document.querySelectorAll(".accept-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            currentBookingId = btn.getAttribute("data-id");
            currentAction = "accept";

            if (modalTitle) modalTitle.textContent = "Accept Booking";
            if (modalDescription)
                modalDescription.textContent =
                    "This will accept the booking and generate a client access link.";
            if (modalConfirm) {
                modalConfirm.classList.remove("bg-red-600", "hover:bg-red-700");
                modalConfirm.classList.add("bg-green-600", "hover:bg-green-700");
                modalConfirm.textContent = "Accept";
            }

            adminNotes.value = "";
            statusModal.showModal();
        });
    });

    // Deny buttons
    document.querySelectorAll(".deny-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            currentBookingId = btn.getAttribute("data-id");
            currentAction = "deny";

            if (modalTitle) modalTitle.textContent = "Deny Booking";
            if (modalDescription)
                modalDescription.textContent =
                    "This will deny the booking request. You can add a reason in the notes.";
            if (modalConfirm) {
                modalConfirm.classList.remove("bg-green-600", "hover:bg-green-700");
                modalConfirm.classList.add("bg-red-600", "hover:bg-red-700");
                modalConfirm.textContent = "Deny";
            }

            adminNotes.value = "";
            statusModal.showModal();
        });
    });

    // Modal cancel
    modalCancel?.addEventListener("click", () => {
        statusModal.close();
        currentBookingId = null;
        currentAction = null;
    });

    // Modal confirm
    modalConfirm?.addEventListener("click", async () => {
        if (!currentBookingId || !currentAction) return;

        const newStatus = currentAction === "accept" ? "accepted" : "denied";
        const notes = adminNotes.value.trim();

        try {
            const updates: any = { status: newStatus };
            if (notes) updates.admin_notes = notes;

            // Generate client access token if accepting
            if (currentAction === "accept") {
                updates.client_access_token = crypto.randomUUID();
            }

            const { data, error } = await supabase
                .from("bookings")
                .update(updates)
                .eq("id", currentBookingId)
                .select()
                .single();

            if (error) throw error;

            statusModal.close();

            // Show link modal if accepted
            if (currentAction === "accept" && data?.client_access_token) {
                const baseUrl = window.location.origin;
                const clientLink = `${baseUrl}/my-booking/${data.client_access_token}`;
                clientLinkInput.value = clientLink;
                linkModal.showModal();
            }

            // Reload page to show updated status
            setTimeout(() => {
                window.location.reload();
            }, currentAction === "accept" ? 0 : 500);
        } catch (err) {
            console.error("Error updating booking:", err);
            alert("Failed to update booking. Please try again.");
        }
    });

    // Copy link
    copyLinkBtn?.addEventListener("click", async () => {
        try {
            await navigator.clipboard.writeText(clientLinkInput.value);
            copyLinkBtn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Copied!
            `;
            setTimeout(() => {
                copyLinkBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    Copy
                `;
            }, 2000);
        } catch (err) {
            console.error("Failed to copy:", err);
        }
    });

    // Link modal close
    linkModalClose?.addEventListener("click", () => {
        linkModal.close();
        window.location.reload();
    });

    // Close modals on backdrop click
    statusModal?.addEventListener("click", (e) => {
        if (e.target === statusModal) {
            statusModal.close();
        }
    });

    linkModal?.addEventListener("click", (e) => {
        if (e.target === linkModal) {
            linkModal.close();
            window.location.reload();
        }
    });
</script>

<style>
    dialog::backdrop {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    dialog[open] {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
</style>


--- src\pages\admin\cms\index.astro

---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { supabase } from "../../../lib/supabase";

// Fetch existing content
let portfolioImages: any[] = [];
let flashDesigns: any[] = [];
let contactInfo = "";
let policyText = "";

try {
    // Fetch portfolio images
    const { data: portfolio } = await supabase
        .from("content_images")
        .select("*")
        .eq("category", "portfolio")
        .order("display_order", { ascending: true });
    portfolioImages = portfolio || [];

    // Fetch flash designs
    const { data: flash } = await supabase
        .from("content_images")
        .select("*")
        .eq("category", "flash")
        .order("display_order", { ascending: true });
    flashDesigns = flash || [];

    // Fetch site settings
    const { data: contactData } = await supabase
        .from("site_settings")
        .select("value")
        .eq("key", "contact_info")
        .single();
    contactInfo = contactData?.value || "";

    const { data: policyData } = await supabase
        .from("site_settings")
        .select("value")
        .eq("key", "policy_text")
        .single();
    policyText = policyData?.value || "";
} catch (error) {
    console.error("Error fetching content:", error);
}
---

<AdminLayout title="Content Management">
    <!-- Tabs -->
    <div class="mb-6">
        <div class="border-b border-gray-200 dark:border-gray-700">
            <nav class="flex gap-4" aria-label="Tabs">
                <button
                    data-tab="portfolio"
                    class="tab-btn active px-4 py-3 text-sm font-medium border-b-2 border-purple-600 text-purple-600"
                >
                    Portfolio Images
                </button>
                <button
                    data-tab="flash"
                    class="tab-btn px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                >
                    Flash Designs
                </button>
                <button
                    data-tab="text"
                    class="tab-btn px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                >
                    Text Content
                </button>
            </nav>
        </div>
    </div>

    <!-- Portfolio Tab -->
    <div id="tab-portfolio" class="tab-content">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 mb-6">
            <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
                Upload New Portfolio Image
            </h3>
            <form id="portfolio-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Image
                        </label>
                        <input
                            type="file"
                            id="portfolio-file"
                            accept="image/*"
                            required
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white file:cursor-pointer"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Title
                        </label>
                        <input
                            type="text"
                            id="portfolio-title"
                            required
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Enter title"
                        />
                    </div>
                </div>
                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >
                        Description
                    </label>
                    <textarea
                        id="portfolio-description"
                        rows="2"
                        class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Enter description"></textarea>
                </div>
                <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input
                            type="checkbox"
                            id="portfolio-featured"
                            class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500"
                        />
                        <span class="text-sm text-gray-700 dark:text-gray-300">
                            Featured on Homepage
                        </span>
                    </label>
                </div>
                <button
                    type="submit"
                    class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                    Upload Image
                </button>
            </form>
        </div>

        <!-- Portfolio Grid -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
                Portfolio Images ({portfolioImages.length})
            </h3>
            {
                portfolioImages.length === 0 ? (
                    <div class="text-center py-12">
                        <svg
                            class="w-16 h-16 mx-auto text-gray-400 mb-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                            />
                        </svg>
                        <p class="text-gray-500 dark:text-gray-400">
                            No portfolio images yet
                        </p>
                    </div>
                ) : (
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        {portfolioImages.map((image) => (
                            <div class="relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700">
                                <img
                                    src={image.url}
                                    alt={image.title}
                                    class="w-full aspect-square object-cover"
                                />
                                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 p-4">
                                    <p class="text-white text-sm font-medium text-center">
                                        {image.title}
                                    </p>
                                    {image.is_featured && (
                                        <span class="px-2 py-1 bg-yellow-500 text-white text-xs rounded">
                                            Featured
                                        </span>
                                    )}
                                    <div class="flex gap-2 mt-2">
                                        <button
                                            class="toggle-featured-btn p-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors"
                                            data-id={image.id}
                                            data-featured={image.is_featured}
                                            title={
                                                image.is_featured
                                                    ? "Remove from featured"
                                                    : "Add to featured"
                                            }
                                        >
                                            <svg
                                                class="w-4 h-4"
                                                fill="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                            </svg>
                                        </button>
                                        <button
                                            class="delete-image-btn p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                                            data-id={image.id}
                                            data-category="portfolio"
                                            title="Delete"
                                        >
                                            <svg
                                                class="w-4 h-4"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                                                />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                )
            }
        </div>
    </div>

    <!-- Flash Tab -->
    <div id="tab-flash" class="tab-content hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 mb-6">
            <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
                Add New Flash Design
            </h3>
            <form id="flash-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Image
                        </label>
                        <input
                            type="file"
                            id="flash-file"
                            accept="image/*"
                            required
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white file:cursor-pointer"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Title
                        </label>
                        <input
                            type="text"
                            id="flash-title"
                            required
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Enter design name"
                        />
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Price ($)
                        </label>
                        <input
                            type="number"
                            id="flash-price"
                            required
                            min="0"
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Enter price"
                        />
                    </div>
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Size
                        </label>
                        <input
                            type="text"
                            id="flash-size"
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="e.g., 3-4 inches"
                        />
                    </div>
                </div>
                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >
                        Description
                    </label>
                    <textarea
                        id="flash-description"
                        rows="2"
                        class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Enter description"></textarea>
                </div>
                <button
                    type="submit"
                    class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                    Add Flash Design
                </button>
            </form>
        </div>

        <!-- Flash Grid -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
            <h3
                class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
            >
                Flash Designs ({flashDesigns.length})
            </h3>
            {
                flashDesigns.length === 0 ? (
                    <div class="text-center py-12">
                        <svg
                            class="w-16 h-16 mx-auto text-gray-400 mb-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"
                            />
                        </svg>
                        <p class="text-gray-500 dark:text-gray-400">
                            No flash designs yet
                        </p>
                    </div>
                ) : (
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        {flashDesigns.map((design) => (
                            <div class="relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700">
                                <img
                                    src={design.url}
                                    alt={design.title}
                                    class="w-full aspect-square object-cover"
                                />
                                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 p-4">
                                    <p class="text-white text-sm font-medium text-center">
                                        {design.title}
                                    </p>
                                    <p class="text-green-400 font-bold">
                                        ${design.price}
                                    </p>
                                    <p class="text-gray-300 text-xs">
                                        {design.size}
                                    </p>
                                    <button
                                        class="delete-image-btn mt-2 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                                        data-id={design.id}
                                        data-category="flash"
                                        title="Delete"
                                    >
                                        <svg
                                            class="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                                            />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                )
            }
        </div>
    </div>

    <!-- Text Content Tab -->
    <div id="tab-text" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Contact Info -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                <h3
                    class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
                >
                    Contact Information
                </h3>
                <form id="contact-form" class="space-y-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Contact Page Content
                        </label>
                        <textarea
                            id="contact-text"
                            rows="10"
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                            placeholder="Enter contact information (supports Markdown)"
                            >{contactInfo}</textarea
                        >
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Supports basic Markdown formatting
                    </p>
                    <button
                        type="submit"
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                    >
                        Save Contact Info
                    </button>
                </form>
            </div>

            <!-- Policy Text -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                <h3
                    class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
                >
                    Policy & Terms
                </h3>
                <form id="policy-form" class="space-y-4">
                    <div>
                        <label
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Policy Page Content
                        </label>
                        <textarea
                            id="policy-text"
                            rows="10"
                            class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 font-mono text-sm"
                            placeholder="Enter policy text (supports Markdown)"
                            >{policyText}</textarea
                        >
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Supports basic Markdown formatting
                    </p>
                    <button
                        type="submit"
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                    >
                        Save Policy Text
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div
        id="loading-overlay"
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"
    >
        <div
            class="bg-white dark:bg-gray-800 rounded-xl p-6 flex items-center gap-4"
        >
            <svg
                class="animate-spin h-6 w-6 text-purple-600"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
            >
                <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"></circle>
                <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
            </svg>
            <span class="text-gray-900 dark:text-white">Processing...</span>
        </div>
    </div>
</AdminLayout>

<script>
    import { supabase } from "../../../lib/supabase";

    const loadingOverlay = document.getElementById("loading-overlay");

    function showLoading() {
        loadingOverlay?.classList.remove("hidden");
    }

    function hideLoading() {
        loadingOverlay?.classList.add("hidden");
    }

    // Tab switching
    const tabBtns = document.querySelectorAll(".tab-btn");
    const tabContents = document.querySelectorAll(".tab-content");

    tabBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            const tabId = btn.getAttribute("data-tab");

            // Update button styles
            tabBtns.forEach((b) => {
                b.classList.remove("border-purple-600", "text-purple-600");
                b.classList.add(
                    "border-transparent",
                    "text-gray-500",
                    "dark:text-gray-400",
                );
            });
            btn.classList.add("border-purple-600", "text-purple-600");
            btn.classList.remove(
                "border-transparent",
                "text-gray-500",
                "dark:text-gray-400",
            );

            // Show/hide content
            tabContents.forEach((content) => {
                content.classList.add("hidden");
            });
            document.getElementById(`tab-${tabId}`)?.classList.remove("hidden");
        });
    });

    // Portfolio form
    const portfolioForm = document.getElementById(
        "portfolio-form",
    ) as HTMLFormElement;
    portfolioForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showLoading();

        const fileInput = document.getElementById(
            "portfolio-file",
        ) as HTMLInputElement;
        const title = (
            document.getElementById("portfolio-title") as HTMLInputElement
        ).value;
        const description = (
            document.getElementById(
                "portfolio-description",
            ) as HTMLTextAreaElement
        ).value;
        const isFeatured = (
            document.getElementById("portfolio-featured") as HTMLInputElement
        ).checked;

        const file = fileInput.files?.[0];
        if (!file) {
            hideLoading();
            alert("Please select an image");
            return;
        }

        try {
            // Upload to storage
            const fileName = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, "")}`;
            const { data: uploadData, error: uploadError } =
                await supabase.storage
                    .from("portfolio-images")
                    .upload(fileName, file);

            if (uploadError) throw uploadError;

            // Get public URL
            const {
                data: { publicUrl },
            } = supabase.storage
                .from("portfolio-images")
                .getPublicUrl(fileName);

            // Insert into database
            const { error: insertError } = await supabase
                .from("content_images")
                .insert({
                    url: publicUrl,
                    category: "portfolio",
                    title,
                    description,
                    is_featured: isFeatured,
                });

            if (insertError) throw insertError;

            hideLoading();
            window.location.reload();
        } catch (err) {
            hideLoading();
            console.error("Error uploading:", err);
            alert("Failed to upload image. Please try again.");
        }
    });

    // Flash form
    const flashForm = document.getElementById("flash-form") as HTMLFormElement;
    flashForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showLoading();

        const fileInput = document.getElementById(
            "flash-file",
        ) as HTMLInputElement;
        const title = (
            document.getElementById("flash-title") as HTMLInputElement
        ).value;
        const price = parseFloat(
            (document.getElementById("flash-price") as HTMLInputElement).value,
        );
        const size = (document.getElementById("flash-size") as HTMLInputElement)
            .value;
        const description = (
            document.getElementById("flash-description") as HTMLTextAreaElement
        ).value;

        const file = fileInput.files?.[0];
        if (!file) {
            hideLoading();
            alert("Please select an image");
            return;
        }

        try {
            // Upload to storage
            const fileName = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.]/g, "")}`;
            const { data: uploadData, error: uploadError } =
                await supabase.storage
                    .from("flash-images")
                    .upload(fileName, file);

            if (uploadError) throw uploadError;

            // Get public URL
            const {
                data: { publicUrl },
            } = supabase.storage.from("flash-images").getPublicUrl(fileName);

            // Insert into database
            const { error: insertError } = await supabase
                .from("content_images")
                .insert({
                    url: publicUrl,
                    category: "flash",
                    title,
                    description,
                    price,
                    size,
                    is_featured: false,
                });

            if (insertError) throw insertError;

            hideLoading();
            window.location.reload();
        } catch (err) {
            hideLoading();
            console.error("Error uploading:", err);
            alert("Failed to upload design. Please try again.");
        }
    });

    // Contact form
    const contactForm = document.getElementById(
        "contact-form",
    ) as HTMLFormElement;
    contactForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showLoading();

        const contactText = (
            document.getElementById("contact-text") as HTMLTextAreaElement
        ).value;

        try {
            const { error } = await supabase
                .from("site_settings")
                .upsert(
                    {
                        key: "contact_info",
                        value: contactText,
                        created_at: new Date().toISOString(),
                    },
                    { onConflict: "key" },
                );

            if (error) throw error;

            hideLoading();
            alert("Contact information saved successfully!");
        } catch (err) {
            hideLoading();
            console.error("Error saving:", err);
            alert("Failed to save. Please try again.");
        }
    });

    // Policy form
    const policyForm = document.getElementById(
        "policy-form",
    ) as HTMLFormElement;
    policyForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showLoading();

        const policyText = (
            document.getElementById("policy-text") as HTMLTextAreaElement
        ).value;

        try {
            const { error } = await supabase
                .from("site_settings")
                .upsert(
                    {
                        key: "policy_text",
                        value: policyText,
                        created_at: new Date().toISOString(),
                    },
                    { onConflict: "key" },
                );

            if (error) throw error;

            hideLoading();
            alert("Policy text saved successfully!");
        } catch (err) {
            hideLoading();
            console.error("Error saving:", err);
            alert("Failed to save. Please try again.");
        }
    });

    // Toggle featured
    document.querySelectorAll(".toggle-featured-btn").forEach((btn) => {
        btn.addEventListener("click", async () => {
            const id = btn.getAttribute("data-id");
            const currentlyFeatured =
                btn.getAttribute("data-featured") === "true";

            showLoading();

            try {
                const { error } = await supabase
                    .from("content_images")
                    .update({ is_featured: !currentlyFeatured })
                    .eq("id", id);

                if (error) throw error;

                hideLoading();
                window.location.reload();
            } catch (err) {
                hideLoading();
                console.error("Error updating:", err);
                alert("Failed to update. Please try again.");
            }
        });
    });

    // Delete image
    document.querySelectorAll(".delete-image-btn").forEach((btn) => {
        btn.addEventListener("click", async () => {
            if (!confirm("Are you sure you want to delete this image?")) return;

            const id = btn.getAttribute("data-id");
            showLoading();

            try {
                const { error } = await supabase
                    .from("content_images")
                    .delete()
                    .eq("id", id);

                if (error) throw error;

                hideLoading();
                window.location.reload();
            } catch (err) {
                hideLoading();
                console.error("Error deleting:", err);
                alert("Failed to delete. Please try again.");
            }
        });
    });
</script>

<style>
    .tab-content {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
</style>


--- src\styles\global.css

@import url("https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Great+Vibes:&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Pacifico&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Doto:wght@100..900&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
    :root {
        --background: 0 0% 70%;
        --foreground: 240 10% 3.9%;
        --card: 0 0% 100%;
        --card-foreground: 240 10% 3.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 240 10% 3.9%;
        --primary: 271 81% 51%;
        --primary-foreground: 0 0% 98%;
        --secondary: 240 4.8% 95.9%;
        --secondary-foreground: 240 5.9% 10%;
        --muted: 240 4.8% 95.9%;
        --muted-foreground: 240 3.8% 46.1%;
        --accent: 240 4.8% 95.9%;
        --accent-foreground: 240 5.9% 10%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 0 0% 98%;
        --border: 240 5.9% 90%;
        --input: 240 5.9% 90%;
        --ring: 271 81% 51%;
        --radius: 0.75rem;
        --pink-cream: 0 100% 96%;
        /* #FFF0F5 */
    }

    .dark {
        --background: 240 10% 3.9%;
        --foreground: 0 0% 98%;
        --card: 240 10% 3.9%;
        --card-foreground: 0 0% 98%;
        --popover: 240 10% 3.9%;
        --popover-foreground: 0 0% 98%;
        --primary: 271 81% 51%;
        --primary-foreground: 0 0% 98%;
        --secondary: 240 3.7% 15.9%;
        --secondary-foreground: 0 0% 98%;
        --muted: 240 3.7% 15.9%;
        --muted-foreground: 240 5% 64.9%;
        --accent: 240 3.7% 15.9%;
        --accent-foreground: 0 0% 98%;
        --destructive: 0 62.8% 30.6%;
        --destructive-foreground: 0 0% 98%;
        --border: 240 3.7% 15.9%;
        --input: 240 3.7% 15.9%;
        --ring: 271 81% 51%;
    }
}

@layer base {
    * {
        @apply border-border;
    }

    body {
        @apply bg-background text-foreground font-playfair;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @apply font-doto;
    }
}

.hero-gradient {
    background: linear-gradient(135deg, #6b46c1 0%, #0a0a0a 100%);
}

.portfolio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.animate-slide-up {
    animation: slideUp 0.5s ease-out forwards;
}

.booking-form-container {
    margin-top: 60px;
    /* Adjust this value based on your navbar height */
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes shooting-star {
    from {
        transform: translate(0, 0);
    }

    to {
        transform: translate(var(--end-x), var(--end-y));
        opacity: 0;
    }
}

/* Circular Gallery Styles */
.circular-gallery {
    width: 100%;
    height: 100%;
    overflow: hidden;
    cursor: grab;
    position: relative;
    touch-action: none;
    background: transparent;
    user-select: none;
    -webkit-user-select: none;
}

.circular-gallery:active {
    cursor: grabbing;
}

.circular-gallery canvas {
    display: block;
    width: 100%;
    height: 100%;
    touch-action: none;
}

.gallery-wrapper {
    position: relative;
    border-radius: var(--radius);
    overflow: hidden;
    background: linear-gradient(
        135deg,
        hsl(var(--background) / 0.5) 0%,
        hsl(var(--muted) / 0.3) 100%
    );
}

.gallery-instructions {
    position: absolute;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    color: hsl(var(--foreground));
    opacity: 0.6;
    font-size: 0.875rem;
    font-family: "Doto", sans-serif;
    pointer-events: none;
    z-index: 10;
    text-align: center;
    transition: opacity 0.3s ease;
    background: hsl(var(--background) / 0.5);
    padding: 0.5rem 1.5rem;
    border-radius: 9999px;
    backdrop-filter: blur(8px);
}

.gallery-wrapper:hover .gallery-instructions,
.circular-gallery:hover + .gallery-instructions {
    opacity: 0.9;
}

/* Portfolio Modal Styles */
#portfolio-modal {
    border: none;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}

#portfolio-modal::backdrop {
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(4px);
}

#portfolio-modal[open] {
    animation: modalFadeIn 0.3s ease-out;
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Modal content responsive styles */
#portfolio-modal .grid {
    display: grid;
}

@media (max-width: 768px) {
    #portfolio-modal .grid {
        grid-template-columns: 1fr;
    }

    #portfolio-modal img {
        max-height: 50vh !important;
    }
}

@media (min-width: 769px) {
    #portfolio-modal .grid {
        grid-template-columns: 1fr 1fr;
    }
}

/* ================================
   Booking Modal Styles
   ================================ */

/* Booking Modal Backdrop */
#booking-modal::backdrop {
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(4px);
    animation: backdropFadeIn 0.3s ease-out;
}

@keyframes backdropFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Step Transition Animations */
.form-step-enter {
    animation: stepSlideIn 0.3s ease-out forwards;
}

.form-step-exit {
    animation: stepSlideOut 0.3s ease-out forwards;
}

@keyframes stepSlideIn {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes stepSlideOut {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(-30px);
    }
}

/* Reverse animation for going back */
.form-step-enter-reverse {
    animation: stepSlideInReverse 0.3s ease-out forwards;
}

.form-step-exit-reverse {
    animation: stepSlideOutReverse 0.3s ease-out forwards;
}

@keyframes stepSlideInReverse {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes stepSlideOutReverse {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(30px);
    }
}

/* Fade transition alternative */
.form-step-fade-enter {
    animation: stepFadeIn 0.3s ease-out forwards;
}

.form-step-fade-exit {
    animation: stepFadeOut 0.2s ease-out forwards;
}

@keyframes stepFadeIn {
    from {
        opacity: 0;
        transform: scale(0.98);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes stepFadeOut {
    from {
        opacity: 1;
        transform: scale(1);
    }
    to {
        opacity: 0;
        transform: scale(0.98);
    }
}

/* Booking trigger button styles */
.booking-trigger {
    font-family: inherit;
    font-size: inherit;
}

/* Ensure modal displays above everything */
#booking-modal {
    z-index: 100;
}

/* Smooth height transitions for modal content */
.booking-modal-content {
    transition: height 0.3s ease-out;
}

/* Input focus states for booking form */
#booking-form input:focus,
#booking-form textarea:focus,
#booking-form select:focus {
    outline: none;
    border-color: hsl(var(--primary));
    box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
}

/* Validation error state */
#booking-form .border-red-500 {
    border-color: hsl(0 84.2% 60.2%) !important;
    animation: shake 0.4s ease-out;
}

@keyframes shake {
    0%,
    100% {
        transform: translateX(0);
    }
    20%,
    60% {
        transform: translateX(-4px);
    }
    40%,
    80% {
        transform: translateX(4px);
    }
}

--- src/pages/admin/bookings/[id].astro
---
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { supabase } from "../../../lib/supabase";

// Get booking ID from URL
const { id } = Astro.params;

if (!id) {
    return Astro.redirect("/admin/bookings");
}

// Fetch booking details
let booking: any = null;
let messages: any[] = [];
let error = null;

try {
    const { data: bookingData, error: bookingError } = await supabase
        .from("bookings")
        .select("*")
        .eq("id", id)
        .single();

    if (bookingError) throw bookingError;
    booking = bookingData;

    // Fetch messages for this booking
    const { data: messagesData, error: messagesError } = await supabase
        .from("messages")
        .select("*")
        .eq("booking_id", id)
        .order("created_at", { ascending: true });

    if (!messagesError) {
        messages = messagesData || [];
    }
} catch (e) {
    console.error("Error fetching booking:", e);
    error = e;
}

// If booking not found, redirect
if (!booking && !error) {
    return Astro.redirect("/admin/bookings");
}

// Format date helper
function formatDate(dateString: string) {
    return new Date(dateString).toLocaleDateString("en-US", {
        month: "long",
        day: "numeric",
        year: "numeric",
        hour: "numeric",
        minute: "2-digit",
    });
}

function formatMessageTime(dateString: string) {
    return new Date(dateString).toLocaleTimeString("en-US", {
        hour: "numeric",
        minute: "2-digit",
    });
}

function getStatusColor(status: string) {
    switch (status) {
        case "pending":
            return "bg-yellow-100 text-yellow-800 border-yellow-300";
        case "accepted":
            return "bg-green-100 text-green-800 border-green-300";
        case "denied":
            return "bg-red-100 text-red-800 border-red-300";
        default:
            return "bg-gray-100 text-gray-800 border-gray-300";
    }
}

const clientLink = booking?.client_access_token
    ? `/my-booking/${booking.client_access_token}`
    : null;
---

<AdminLayout title={`Booking - ${booking?.first_name} ${booking?.last_name}`}>
    {
        error ? (
            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 text-center">
                <p class="text-red-600 dark:text-red-400">
                    Error loading booking. Please try again.
                </p>
                <a
                    href="/admin/bookings"
                    class="text-purple-600 hover:underline mt-2 inline-block"
                >
                    ← Back to Bookings
                </a>
            </div>
        ) : (
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Booking Details -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Header Card -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                        <div class="flex items-start justify-between mb-6">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center">
                                    <span class="text-purple-600 dark:text-purple-400 font-bold text-xl">
                                        {booking.first_name?.[0]?.toUpperCase()}
                                        {booking.last_name?.[0]?.toUpperCase()}
                                    </span>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                                        {booking.first_name} {booking.last_name}
                                    </h2>
                                    <p class="text-gray-500 dark:text-gray-400">
                                        {booking.email}
                                    </p>
                                    <p class="text-gray-500 dark:text-gray-400">
                                        {booking.phone}
                                    </p>
                                </div>
                            </div>
                            <span
                                class={`px-4 py-2 rounded-full text-sm font-medium capitalize border ${getStatusColor(booking.status)}`}
                            >
                                {booking.status}
                            </span>
                        </div>

                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Submitted
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {formatDate(booking.created_at)}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Booking Type
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.is_custom
                                            ? "Custom Design"
                                            : "Flash Design"}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Size
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.tattoo_size}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Placement
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.tattoo_placement}
                                    </dd>
                                </div>
                                {booking.agreed_price && (
                                    <div>
                                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                            Agreed Price
                                        </dt>
                                        <dd class="mt-1 text-gray-900 dark:text-white font-semibold">
                                            ${booking.agreed_price}
                                        </dd>
                                    </div>
                                )}
                                {booking.scheduled_date && (
                                    <div>
                                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                            Scheduled Date
                                        </dt>
                                        <dd class="mt-1 text-gray-900 dark:text-white">
                                            {formatDate(booking.scheduled_date)}
                                        </dd>
                                    </div>
                                )}
                            </dl>
                        </div>
                    </div>

                    <!-- Tattoo Idea -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            Tattoo Idea
                        </h3>
                        <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">
                            {booking.tattoo_idea}
                        </p>
                    </div>

                    <!-- Reference Photos -->
                    {booking.reference_photos &&
                        booking.reference_photos.length > 0 && (
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                    Reference Photos
                                </h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                    {booking.reference_photos.map(
                                        (photo: string, index: number) => (
                                            <a
                                                href={photo}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                class="block aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700 hover:opacity-80 transition-opacity"
                                            >
                                                <img
                                                    src={photo}
                                                    alt={`Reference ${index + 1}`}
                                                    class="w-full h-full object-cover"
                                                />
                                            </a>
                                        ),
                                    )}
                                </div>
                            </div>
                        )}

                    <!-- Admin Notes -->
                    {booking.admin_notes && (
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                Admin Notes
                            </h3>
                            <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">
                                {booking.admin_notes}
                            </p>
                        </div>
                    )}
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Actions -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                            Actions
                        </h3>
                        <div class="space-y-3">
                            {booking.status === "pending" && (
                                <>
                                    <button
                                        id="accept-btn"
                                        class="w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                                    >
                                        <svg
                                            class="w-5 h-5"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M5 13l4 4L19 7"
                                            />
                                        </svg>
                                        Accept Booking
                                    </button>
                                    <button
                                        id="deny-btn"
                                        class="w-full py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2"
                                    >
                                        <svg
                                            class="w-5 h-5"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M6 18L18 6M6 6l12 12"
                                            />
                                        </svg>
                                        Deny Booking
                                    </button>
                                </>
                            )}
                            <button
                                id="edit-btn"
                                class="w-full py-2 px-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2"
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                                    />
                                </svg>
                                Edit Details
                            </button>
                            <a
                                href="/admin/bookings"
                                class="w-full py-2 px-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center justify-center gap-2"
                            >
                                ← Back to List
                            </a>
                        </div>
                    </div>

                    <!-- Client Link -->
                    {clientLink && (
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                Client Access Link
                            </h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">
                                Share this link with the client:
                            </p>
                            <div class="flex gap-2">
                                <input
                                    id="client-link-input"
                                    type="text"
                                    readonly
                                    value={`${Astro.url.origin}${clientLink}`}
                                    class="flex-1 px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-900 dark:text-white"
                                />
                                <button
                                    id="copy-link-btn"
                                    class="px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                    title="Copy link"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                                        />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    )}

                    <!-- Chat -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                Chat with Client
                            </h3>
                        </div>

                        <!-- Messages -->
                        <div
                            id="messages-container"
                            class="h-80 overflow-y-auto p-4 space-y-4"
                        >
                            {messages.length === 0 ? (
                                <div class="text-center py-8">
                                    <svg
                                        class="w-12 h-12 mx-auto text-gray-400 mb-3"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                                        />
                                    </svg>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">
                                        No messages yet
                                    </p>
                                    <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">
                                        Start a conversation with the client
                                    </p>
                                </div>
                            ) : (
                                messages.map((msg) => (
                                    <div
                                        class={`flex ${msg.sender_role === "admin" ? "justify-end" : "justify-start"}`}
                                    >
                                        <div
                                            class={`max-w-[80%] rounded-lg px-4 py-2 ${
                                                msg.sender_role === "admin"
                                                    ? "bg-purple-600 text-white"
                                                    : "bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"
                                            }`}
                                        >
                                            <p class="text-sm">{msg.content}</p>
                                            <p
                                                class={`text-xs mt-1 ${
                                                    msg.sender_role === "admin"
                                                        ? "text-purple-200"
                                                        : "text-gray-500 dark:text-gray-400"
                                                }`}
                                            >
                                                {formatMessageTime(
                                                    msg.created_at,
                                                )}
                                            </p>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        <!-- Message Input -->
                        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                            <form id="message-form" class="flex gap-2">
                                <input
                                    type="text"
                                    id="message-input"
                                    placeholder="Type a message..."
                                    class="flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                                <button
                                    type="submit"
                                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                                        />
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        )
    }

    <!-- Edit Modal -->
    <dialog id="edit-modal" class="fixed inset-0 z-50 bg-transparent p-4">
        <div
            class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-auto mt-20 p-6"
        >
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
                Edit Booking Details
            </h3>

            <form id="edit-form" class="space-y-4">
                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >
                        Agreed Price ($)
                    </label>
                    <input
                        type="number"
                        id="edit-price"
                        value={booking?.agreed_price || ""}
                        class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Enter price"
                    />
                </div>

                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >
                        Scheduled Date
                    </label>
                    <input
                        type="datetime-local"
                        id="edit-date"
                        value={booking?.scheduled_date?.slice(0, 16) || ""}
                        class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                    />
                </div>

                <div>
                    <label
                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                    >
                        Admin Notes
                    </label>
                    <textarea
                        id="edit-notes"
                        rows="3"
                        class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Add notes..."
                    >{booking?.admin_notes || ""}</textarea>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button
                        type="button"
                        id="edit-cancel"
                        class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
                    >
                        Cancel
                    </button>
                    <button
                        type="submit"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                    >
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Status Update Modal -->
    <dialog id="status-modal" class="fixed inset-0 z-50 bg-transparent p-4">
        <div
            class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full mx-auto mt-20 p-6"
        >
            <h3
                id="status-modal-title"
                class="text-xl font-bold text-gray-900 dark:text-white mb-4"
            >
            </h3>
            <p
                id="status-modal-desc"
                class="text-gray-600 dark:text-gray-400 mb-6"
            >
            </p>

            <div class="flex justify-end gap-3">
                <button
                    id="status-cancel"
                    class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
                >
                    Cancel
                </button>
                <button
                    id="status-confirm"
                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                >
                    Confirm
                </button>
            </div>
        </div>
    </dialog>
</AdminLayout>

<script define:vars={{ bookingId: id }}>
    window.bookingId = bookingId;
</script>

<script>
    import { supabase } from "../../../lib/supabase";

    const bookingId = (window as any).bookingId;

    // Copy link functionality
    const copyLinkBtn = document.getElementById("copy-link-btn");
    const clientLinkInput = document.getElementById(
        "client-link-input",
    ) as HTMLInputElement;

    copyLinkBtn?.addEventListener("click", async () => {
        if (clientLinkInput) {
            try {
                await navigator.clipboard.writeText(clientLinkInput.value);
                copyLinkBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                `;
                setTimeout(() => {
                    copyLinkBtn.innerHTML = `
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                    `;
                }, 2000);
            } catch (err) {
                console.error("Failed to copy:", err);
            }
        }
    });

    // Edit modal
    const editBtn = document.getElementById("edit-btn");
    const editModal = document.getElementById("edit-modal") as HTMLDialogElement;
    const editCancel = document.getElementById("edit-cancel");
    const editForm = document.getElementById("edit-form") as HTMLFormElement;

    editBtn?.addEventListener("click", () => {
        editModal?.showModal();
    });

    editCancel?.addEventListener("click", () => {
        editModal?.close();
    });

    editModal?.addEventListener("click", (e) => {
        if (e.target === editModal) {
            editModal.close();
        }
    });

    editForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const price = (document.getElementById("edit-price") as HTMLInputElement)
            ?.value;
        const date = (document.getElementById("edit-date") as HTMLInputElement)
            ?.value;
        const notes = (
            document.getElementById("edit-notes") as HTMLTextAreaElement
        )?.value;

        const updates: any = {};
        if (price) updates.agreed_price = parseFloat(price);
        if (date) updates.scheduled_date = new Date(date).toISOString();
        if (notes !== undefined) updates.admin_notes = notes;

        try {
            const { error } = await supabase
                .from("bookings")
                .update(updates)
                .eq("id", bookingId);

            if (error) throw error;

            editModal?.close();
            window.location.reload();
        } catch (err) {
            console.error("Error updating booking:", err);
            alert("Failed to update booking. Please try again.");
        }
    });

    // Status update modal
    const acceptBtn = document.getElementById("accept-btn");
    const denyBtn = document.getElementById("deny-btn");
    const statusModal = document.getElementById(
        "status-modal",
    ) as HTMLDialogElement;
    const statusModalTitle = document.getElementById("status-modal-title");
    const statusModalDesc = document.getElementById("status-modal-desc");
    const statusCancel = document.getElementById("status-cancel");
    const statusConfirm = document.getElementById("status-confirm");

    let currentStatusAction: "accept" | "deny" | null = null;

    acceptBtn?.addEventListener("click", () => {
        currentStatusAction = "accept";
        if (statusModalTitle)
            statusModalTitle.textContent = "Accept Booking";
        if (statusModalDesc)
            statusModalDesc.textContent =
                "This will accept the booking and generate a client access link.";
        if (statusConfirm) {
            statusConfirm.className =
                "px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors";
            statusConfirm.textContent = "Accept";
        }
        statusModal?.showModal();
    });

    denyBtn?.addEventListener("click", () => {
        currentStatusAction = "deny";
        if (statusModalTitle) statusModalTitle.textContent = "Deny Booking";
        if (statusModalDesc)
            statusModalDesc.textContent =
                "This will deny the booking request.";
        if (statusConfirm) {
            statusConfirm.className =
                "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors";
            statusConfirm.textContent = "Deny";
        }
        statusModal?.showModal();
    });

    statusCancel?.addEventListener("click", () => {
        statusModal?.close();
        currentStatusAction = null;
    });

    statusModal?.addEventListener("click", (e) => {
        if (e.target === statusModal) {
            statusModal.close();
            currentStatusAction = null;
        }
    });

    statusConfirm?.addEventListener("click", async () => {
        if (!currentStatusAction) return;

        const newStatus = currentStatusAction === "accept" ? "accepted" : "denied";
        const updates: any = { status: newStatus };

        if (currentStatusAction === "accept") {
            updates.client_access_token = crypto.randomUUID();
        }

        try {
            const { error } = await supabase
                .from("bookings")
                .update(updates)
                .eq("id", bookingId);

            if (error) throw error;

            statusModal?.close();
            window.location.reload();
        } catch (err) {
            console.error("Error updating booking:", err);
            alert("Failed to update booking. Please try again.");
        }
    });

    // Chat functionality
    const messageForm = document.getElementById("message-form") as HTMLFormElement;
    const messageInput = document.getElementById("message-input") as HTMLInputElement;
    const messagesContainer = document.getElementById("messages-container");

    function formatMessageTime(date: Date) {
        return date.toLocaleTimeString("en-US", {
            hour: "numeric",
            minute: "2-digit",
        });
    }

    function addMessageToUI(message: { content: string; sender_role: string; created_at: string }) {
        if (!messagesContainer) return;

        // Remove "no messages" placeholder if exists
        const placeholder = messagesContainer.querySelector(".text-center.py-8");
        if (placeholder) {
            placeholder.remove();
        }

        const messageDiv = document.createElement("div");
        messageDiv.className = `flex ${message.sender_role === "admin" ? "justify-end" : "justify-start"}`;

        const bubbleClass = message.sender_role === "admin"
            ? "bg-purple-600 text-white"
            : "bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white";

        const timeClass = message.sender_role === "admin"
            ? "text-purple-200"
            : "text-gray-500 dark:text-gray-400";

        messageDiv.innerHTML = `
            <div class="max-w-[80%] rounded-lg px-4 py-2 ${bubbleClass}">
                <p class="text-sm">${message.content}</p>
                <p class="text-xs mt-1 ${timeClass}">${formatMessageTime(new Date(message.created_at))}</p>
            </div>
        `;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    messageForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const content = messageInput?.value.trim();
        if (!content) return;

        try {
            const { data, error } = await supabase
                .from("messages")
                .insert({
                    booking_id: bookingId,
                    sender_role: "admin",
                    content,
                })
                .select()
                .single();

            if (error) throw error;

            messageInput.value = "";
            addMessageToUI(data);
        } catch (err) {
            console.error("Error sending message:", err);
            alert("Failed to send message. Please try again.");
        }
    });

    // Subscribe to realtime messages
    const channel = supabase
        .channel(`messages:${bookingId}`)
        .on(
            "postgres_changes",
            {
                event: "INSERT",
                schema: "public",
                table: "messages",
                filter: `booking_id=eq.${bookingId}`,
            },
            (payload) => {
                const message = payload.new as any;
                // Only add if it's from the client (admin messages are added immediately)
                if (message.sender_role === "client") {
                    addMessageToUI(message);
                }
            }
        )
        .subscribe();

    // Scroll to bottom of messages on load
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
</script>

<style>
    dialog::backdrop {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    dialog[open] {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
</style>

---- src/pages/my-booking/[token].astro

---
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../lib/supabase";

// Get token from URL
const { token } = Astro.params;

if (!token) {
    return Astro.redirect("/");
}

// Fetch booking by token
let booking: any = null;
let messages: any[] = [];
let error = null;

try {
    const { data: bookingData, error: bookingError } = await supabase
        .from("bookings")
        .select("*")
        .eq("client_access_token", token)
        .single();

    if (bookingError || !bookingData) {
        return new Response(null, {
            status: 404,
            statusText: "Not Found",
        });
    }

    booking = bookingData;

    // Fetch messages for this booking
    const { data: messagesData } = await supabase
        .from("messages")
        .select("*")
        .eq("booking_id", booking.id)
        .order("created_at", { ascending: true });

    messages = messagesData || [];
} catch (e) {
    console.error("Error fetching booking:", e);
    error = e;
}

// Format date helper
function formatDate(dateString: string) {
    return new Date(dateString).toLocaleDateString("en-US", {
        month: "long",
        day: "numeric",
        year: "numeric",
    });
}

function formatMessageTime(dateString: string) {
    return new Date(dateString).toLocaleTimeString("en-US", {
        hour: "numeric",
        minute: "2-digit",
    });
}

function getStatusInfo(status: string) {
    switch (status) {
        case "pending":
            return {
                color: "bg-yellow-100 text-yellow-800 border-yellow-300",
                icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
                message: "Your booking request is being reviewed. We'll get back to you soon!",
            };
        case "accepted":
            return {
                color: "bg-green-100 text-green-800 border-green-300",
                icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
                message: "Great news! Your booking has been accepted. Check the details below.",
            };
        case "denied":
            return {
                color: "bg-red-100 text-red-800 border-red-300",
                icon: "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
                message: "Unfortunately, we couldn't accept this booking request. Please see the notes below or contact us for more information.",
            };
        default:
            return {
                color: "bg-gray-100 text-gray-800 border-gray-300",
                icon: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
                message: "",
            };
    }
}

const statusInfo = booking ? getStatusInfo(booking.status) : null;
---

<Layout title="My Booking | KowTattys">
    <div class="container mx-auto px-4 py-12 max-w-4xl">
        {error ? (
            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-8 text-center">
                <svg class="w-16 h-16 mx-auto text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <h2 class="text-2xl font-bold text-red-600 dark:text-red-400 mb-2">
                    Error Loading Booking
                </h2>
                <p class="text-gray-600 dark:text-gray-400">
                    There was an error loading your booking. Please try again later.
                </p>
                <a href="/" class="inline-block mt-6 text-purple-600 hover:underline">
                    ← Return to Homepage
                </a>
            </div>
        ) : !booking ? (
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8 text-center">
                <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                    Booking Not Found
                </h2>
                <p class="text-gray-600 dark:text-gray-400">
                    We couldn't find a booking with this link. Please check the URL or contact us for assistance.
                </p>
                <a href="/" class="inline-block mt-6 text-purple-600 hover:underline">
                    ← Return to Homepage
                </a>
            </div>
        ) : (
            <div class="space-y-6">
                <!-- Header -->
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold font-doto mb-2">My Booking</h1>
                    <p class="text-muted-foreground">
                        Track your booking status and communicate with our team
                    </p>
                </div>

                <!-- Status Banner -->
                <div class={`rounded-xl p-6 border ${statusInfo?.color}`}>
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={statusInfo?.icon} />
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold capitalize mb-1">
                                Status: {booking.status}
                            </h2>
                            <p class="opacity-80">
                                {statusInfo?.message}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Booking Details -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Main Details Card -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                Booking Details
                            </h3>
                            <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Submitted
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {formatDate(booking.created_at)}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Type
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.is_custom ? "Custom Design" : "Flash Design"}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Size
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.tattoo_size}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                        Placement
                                    </dt>
                                    <dd class="mt-1 text-gray-900 dark:text-white">
                                        {booking.tattoo_placement}
                                    </dd>
                                </div>
                                {booking.agreed_price && (
                                    <div>
                                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                            Agreed Price
                                        </dt>
                                        <dd class="mt-1 text-gray-900 dark:text-white font-semibold text-green-600">
                                            ${booking.agreed_price}
                                        </dd>
                                    </div>
                                )}
                                {booking.scheduled_date && (
                                    <div>
                                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">
                                            Scheduled Date
                                        </dt>
                                        <dd class="mt-1 text-gray-900 dark:text-white font-semibold">
                                            {formatDate(booking.scheduled_date)}
                                        </dd>
                                    </div>
                                )}
                            </dl>
                        </div>

                        <!-- Tattoo Idea -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                Your Tattoo Idea
                            </h3>
                            <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">
                                {booking.tattoo_idea}
                            </p>
                        </div>

                        <!-- Reference Photos -->
                        {booking.reference_photos && booking.reference_photos.length > 0 && (
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                    Your Reference Photos
                                </h3>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                    {booking.reference_photos.map((photo: string, index: number) => (
                                        <a
                                            href={photo}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="block aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700 hover:opacity-80 transition-opacity"
                                        >
                                            <img
                                                src={photo}
                                                alt={`Reference ${index + 1}`}
                                                class="w-full h-full object-cover"
                                            />
                                        </a>
                                    ))}
                                </div>
                            </div>
                        )}

                        <!-- Admin Notes (if any) -->
                        {booking.admin_notes && (
                            <div class="bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800 p-6">
                                <h3 class="text-lg font-semibold text-purple-900 dark:text-purple-100 mb-4 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                                    </svg>
                                    Note from Artist
                                </h3>
                                <p class="text-purple-800 dark:text-purple-200 whitespace-pre-wrap">
                                    {booking.admin_notes}
                                </p>
                            </div>
                        )}
                    </div>

                    <!-- Chat Sidebar -->
                    <div class="lg:col-span-1">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden sticky top-24">
                            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                    </svg>
                                    Chat with Artist
                                </h3>
                            </div>

                            <!-- Messages -->
                            <div
                                id="messages-container"
                                class="h-80 overflow-y-auto p-4 space-y-4"
                            >
                                {messages.length === 0 ? (
                                    <div class="text-center py-8">
                                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                        </svg>
                                        <p class="text-gray-500 dark:text-gray-400 text-sm">
                                            No messages yet
                                        </p>
                                        <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">
                                            Send a message to start the conversation
                                        </p>
                                    </div>
                                ) : (
                                    messages.map((msg) => (
                                        <div class={`flex ${msg.sender_role === "client" ? "justify-end" : "justify-start"}`}>
                                            <div
                                                class={`max-w-[85%] rounded-lg px-4 py-2 ${
                                                    msg.sender_role === "client"
                                                        ? "bg-purple-600 text-white"
                                                        : "bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"
                                                }`}
                                            >
                                                <p class="text-sm">{msg.content}</p>
                                                <p
                                                    class={`text-xs mt-1 ${
                                                        msg.sender_role === "client"
                                                            ? "text-purple-200"
                                                            : "text-gray-500 dark:text-gray-400"
                                                    }`}
                                                >
                                                    {formatMessageTime(msg.created_at)}
                                                </p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>

                            <!-- Message Input -->
                            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                                <form id="message-form" class="flex gap-2">
                                    <input
                                        type="text"
                                        id="message-input"
                                        placeholder="Type a message..."
                                        class="flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                                    />
                                    <button
                                        type="submit"
                                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                    >
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Back to Home -->
                <div class="text-center mt-8">
                    <a href="/" class="text-purple-600 hover:underline">
                        ← Back to Homepage
                    </a>
                </div>
            </div>
        )}
    </div>
</Layout>

<script define:vars={{ bookingId: booking?.id }}>
    window.bookingId = bookingId;
</script>

<script>
    import { supabase } from "../../lib/supabase";

    const bookingId = (window as any).bookingId;

    if (!bookingId) {
        console.error("No booking ID found");
    }

    const messageForm = document.getElementById("message-form") as HTMLFormElement;
    const messageInput = document.getElementById("message-input") as HTMLInputElement;
    const messagesContainer = document.getElementById("messages-container");

    function formatMessageTime(date: Date) {
        return date.toLocaleTimeString("en-US", {
            hour: "numeric",
            minute: "2-digit",
        });
    }

    function addMessageToUI(message: { content: string; sender_role: string; created_at: string }) {
        if (!messagesContainer) return;

        // Remove "no messages" placeholder if exists
        const placeholder = messagesContainer.querySelector(".text-center.py-8");
        if (placeholder) {
            placeholder.remove();
        }

        const messageDiv = document.createElement("div");
        messageDiv.className = `flex ${message.sender_role === "client" ? "justify-end" : "justify-start"}`;

        const bubbleClass = message.sender_role === "client"
            ? "bg-purple-600 text-white"
            : "bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white";

        const timeClass = message.sender_role === "client"
            ? "text-purple-200"
            : "text-gray-500 dark:text-gray-400";

        messageDiv.innerHTML = `
            <div class="max-w-[85%] rounded-lg px-4 py-2 ${bubbleClass}">
                <p class="text-sm">${message.content}</p>
                <p class="text-xs mt-1 ${timeClass}">${formatMessageTime(new Date(message.created_at))}</p>
            </div>
        `;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    messageForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const content = messageInput?.value.trim();
        if (!content || !bookingId) return;

        try {
            const { data, error } = await supabase
                .from("messages")
                .insert({
                    booking_id: bookingId,
                    sender_role: "client",
                    content,
                })
                .select()
                .single();

            if (error) throw error;

            messageInput.value = "";
            addMessageToUI(data);
        } catch (err) {
            console.error("Error sending message:", err);
            alert("Failed to send message. Please try again.");
        }
    });

    // Subscribe to realtime messages
    if (bookingId) {
        const channel = supabase
            .channel(`messages:${bookingId}`)
            .on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "messages",
                    filter: `booking_id=eq.${bookingId}`,
                },
                (payload) => {
                    const message = payload.new as any;
                    // Only add if it's from the admin (client messages are added immediately)
                    if (message.sender_role === "admin") {
                        addMessageToUI(message);
                    }
                }
            )
            .subscribe();
    }

    // Scroll to bottom of messages on load
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
</script>

<style>
    #messages-container {
        scrollbar-width: thin;
        scrollbar-color: hsl(var(--muted)) transparent;
    }

    #messages-container::-webkit-scrollbar {
        width: 6px;
    }

    #messages-container::-webkit-scrollbar-track {
        background: transparent;
    }

    #messages-container::-webkit-scrollbar-thumb {
        background-color: hsl(var(--muted));
        border-radius: 3px;
    }
</style>
