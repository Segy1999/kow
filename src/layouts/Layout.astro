---
import "../styles/global.css";
import BookingModal from "../components/BookingModal.astro";

interface Props {
    title: string;
    description?: string;
}

const { title, description = "Toronto's premiere tattoo experience" } =
    Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>{title}</title>
        <!-- Prevent Flash of Incorrect Theme -->
        <script is:inline>
            const theme = (() => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            })();
            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>
    </head>
    <body
        class="bg-background text-foreground font-playfair min-h-screen flex flex-col"
    >
        <header
            class="fixed w-full z-50 bg-background/80 backdrop-blur-sm border-b"
        >
            <div
                class="container mx-auto px-4 h-16 flex justify-between items-center"
            >
                <a href="/" class="font-doto text-4xl font-bold">KowTattys</a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="/" class="hover:text-primary transition-colors"
                        >Home</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors">Flash</a
                    >
                    <button
                        class="booking-trigger hover:text-primary transition-colors cursor-pointer bg-transparent border-none font-inherit text-inherit"
                    >
                        Book Now
                    </button>
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >

                    <div class="flex items-center gap-2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-yellow-500"
                            ><circle cx="12" cy="12" r="5"></circle><path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                            ></path></svg
                        >

                        <button
                            id="theme-toggle"
                            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 transition-colors duration-300 focus:outline-none"
                            aria-label="Toggle Theme"
                        >
                            <div
                                class="absolute top-[2px] left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-transform duration-300 dark:translate-x-full dark:border-gray-600"
                            >
                            </div>
                        </button>

                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-gray-700 dark:text-gray-300"
                            ><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"
                            ></path></svg
                        >
                    </div>
                </nav>

                <!-- Mobile Menu Button -->
                <button
                    id="mobile-menu-btn"
                    class="md:hidden p-2 text-foreground focus:outline-none"
                    aria-label="Toggle mobile menu"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <!-- Mobile Menu Dropdown -->
            <div
                id="mobile-menu"
                class="hidden md:hidden bg-background/95 backdrop-blur-sm border-b transition-all duration-300 ease-in-out"
            >
                <nav class="flex flex-col p-4 space-y-4">
                    <a
                        href="/"
                        class="text-lg hover:text-primary transition-colors"
                        >Home</a
                    >
                    <a
                        href="/portfolio"
                        class="text-lg hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="text-lg hover:text-primary transition-colors"
                        >Flash</a
                    >
                    <button
                        class="booking-trigger text-lg hover:text-primary transition-colors cursor-pointer bg-transparent border-none font-inherit text-inherit text-left"
                    >
                        Book Now
                    </button>
                    <a
                        href="/contact"
                        class="text-lg hover:text-primary transition-colors"
                        >Contact</a
                    >
                    <div class="flex items-center gap-2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-yellow-500"
                            ><circle cx="12" cy="12" r="5"></circle><path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                            ></path></svg
                        >

                        <button
                            id="theme-toggle-mobile"
                            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 transition-colors duration-300 focus:outline-none"
                            aria-label="Toggle Theme"
                        >
                            <div
                                class="absolute top-[2px] left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-transform duration-300 dark:translate-x-full dark:border-gray-600"
                            >
                            </div>
                        </button>

                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-gray-700 dark:text-gray-300"
                            ><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"
                            ></path></svg
                        >
                    </div>
                </nav>
            </div>
        </header>

        <main class="flex-grow pt-16">
            <slot />
        </main>

        <footer class="bg-background border-t py-8 mt-20">
            <div
                class="container mx-auto px-4 text-center text-muted-foreground"
            >
                <div class="flex justify-center gap-6 mb-4">
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >
                    <a
                        href="/policy"
                        class="hover:text-primary transition-colors">Policies</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors"
                        >Flash Designs</a
                    >
                </div>
                <p>
                    &copy; {new Date().getFullYear()} Kow Tattys. All rights reserved.
                </p>
            </div>
        </footer>

        <!-- Global Booking Modal -->
        <BookingModal />

        <script>
            // Vanilla JS for Theme Toggle
            const handleToggleClick = () => {
                const element = document.documentElement;
                element.classList.toggle("dark");
                const isDark = element.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            };

            // Attach to both desktop and mobile toggle buttons
            ["theme-toggle", "theme-toggle-mobile"].forEach((id) => {
                document
                    .getElementById(id)
                    ?.addEventListener("click", handleToggleClick);
            });

            // Vanilla JS for Mobile Menu Toggle
            const btn = document.getElementById("mobile-menu-btn");
            const menu = document.getElementById("mobile-menu");

            btn?.addEventListener("click", () => {
                menu?.classList.toggle("hidden");
            });

            // Booking Modal Triggers
            document.querySelectorAll(".booking-trigger").forEach((trigger) => {
                trigger.addEventListener("click", (e) => {
                    e.preventDefault();
                    // Close mobile menu if open
                    menu?.classList.add("hidden");
                    // Dispatch custom event to open booking modal
                    window.dispatchEvent(new CustomEvent("openBookingModal"));
                });
            });
        </script>
    </body>
</html>
