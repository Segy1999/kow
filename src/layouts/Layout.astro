---
import "../styles/global.css";
import BookingModal from "../components/BookingModal.astro";

interface Props {
    title: string;
    description?: string;
}

const { title, description = "Toronto's premiere tattoo experience" } =
    Astro.props;

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

        <!-- Preload critical fonts for faster rendering -->
        <link
            rel="preconnect"
            href="https://fonts.googleapis.com"
            crossorigin
        />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            rel="preload"
            as="style"
            href="https://fonts.googleapis.com/css2?family=Doto:wght@400;700&display=swap"
        />
        <link
            rel="preload"
            as="style"
            href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap"
        />

        <title>{title}</title>
        <!-- Prevent Flash of Incorrect Theme -->
        <script is:inline>
            const theme = (() => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            })();
            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>
    </head>
    <body
        class="bg-background text-foreground font-playfair min-h-screen flex flex-col"
    >
        <header
            class="fixed w-full z-[100] bg-background/80 backdrop-blur-sm border-b"
        >
            <div
                class="container mx-auto px-4 h-16 flex justify-between items-center"
            >
                <a href="/" class="font-doto text-4xl font-bold">KowTattys</a>

                <nav class="hidden md:flex items-center space-x-8">
                    <a href="/" class="hover:text-primary transition-colors"
                        >Home</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors">Flash</a
                    >
                    <button
                        class="booking-trigger hover:text-primary transition-colors cursor-pointer bg-transparent border-none font-inherit text-inherit"
                    >
                        Book Now
                    </button>
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >

                    <div class="flex items-center gap-2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-yellow-500"
                            ><circle cx="12" cy="12" r="5"></circle><path
                                d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                            ></path></svg
                        >

                        <button
                            id="theme-toggle"
                            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 transition-colors duration-300 focus:outline-none"
                            aria-label="Toggle Theme"
                        >
                            <div
                                class="absolute top-[2px] left-[2px] bg-white border-gray-300 border rounded-full h-5 w-5 transition-transform duration-300 dark:translate-x-full dark:border-gray-600"
                            >
                            </div>
                        </button>

                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            class="text-gray-700 dark:text-gray-300"
                            ><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"
                            ></path></svg
                        >
                    </div>
                </nav>

                <!-- Mobile Menu Button -->
                <button
                    id="mobile-menu-btn"
                    class="md:hidden p-2 text-foreground focus:outline-none"
                    aria-label="Toggle mobile menu"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Mobile Menu Dropdown -->
        <div
            id="mobile-menu"
            class="fixed top-0 left-0 right-0 bg-background/95 backdrop-blur-xl transition-all duration-300 ease-in-out z-[150] md:hidden opacity-0 pointer-events-none -translate-y-full rounded-b-[2.5rem] shadow-2xl pb-10 border-b border-foreground/5"
        >
            <!-- Mobile Menu Header -->
            <div class="h-16 flex justify-between items-center px-4">
                <span class="font-doto text-4xl font-bold">KowTattys</span>
                <button
                    id="mobile-menu-close"
                    class="p-2 text-foreground focus:outline-none"
                    aria-label="Close mobile menu"
                >
                    <svg
                        class="w-8 h-8"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <nav class="flex flex-col px-6 pt-8 space-y-2">
                <a
                    href="/"
                    class={`text-lg px-5 py-3 rounded-2xl transition-all font-semibold ${
                        currentPath === "/"
                            ? "bg-white text-black shadow-sm"
                            : "hover:bg-foreground/5"
                    }`}
                >
                    Home
                </a>
                <a
                    href="/portfolio"
                    class={`text-lg px-5 py-3 rounded-2xl transition-all font-semibold ${
                        currentPath === "/portfolio"
                            ? "bg-white text-black shadow-sm"
                            : "hover:bg-foreground/5"
                    }`}
                >
                    Portfolio
                </a>
                <button
                    class="booking-trigger text-lg px-5 py-3 rounded-2xl transition-all font-semibold font-playfair hover:bg-foreground/5 text-left w-full"
                >
                    Book Now
                </button>
                <a
                    href="/policy"
                    class={`text-lg px-5 py-3 rounded-2xl transition-all font-semibold ${
                        currentPath === "/policy"
                            ? "bg-white text-black shadow-sm"
                            : "hover:bg-foreground/5"
                    }`}
                >
                    Policy
                </a>
                <a
                    href="/contact"
                    class={`text-lg px-5 py-3 rounded-2xl transition-all font-semibold ${
                        currentPath === "/contact"
                            ? "bg-white text-black shadow-sm"
                            : "hover:bg-foreground/5"
                    }`}
                >
                    Contact
                </a>

                <!-- Theme Toggle Switch -->
                <div class="flex items-center gap-4 px-4 pt-10">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-foreground"
                    >
                        <circle cx="12" cy="12" r="5"></circle>
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                        ></path>
                    </svg>

                    <button
                        id="theme-toggle-mobile"
                        class="relative w-14 h-7 bg-foreground/20 rounded-full focus:outline-none transition-colors"
                        aria-label="Toggle Theme"
                    >
                        <div
                            class="absolute top-[3px] left-[3px] bg-background rounded-full h-[22px] w-[22px] transition-transform duration-300 dark:translate-x-7"
                        >
                        </div>
                    </button>

                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-foreground"
                    >
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                    </svg>
                </div>
            </nav>
        </div>

        <main class="flex-grow pt-16">
            <slot />
        </main>

        <footer class="bg-background border-t py-8 mt-20">
            <div
                class="container mx-auto px-4 text-center text-muted-foreground"
            >
                <div class="flex justify-center gap-6 mb-4">
                    <a
                        href="/contact"
                        class="hover:text-primary transition-colors">Contact</a
                    >
                    <a
                        href="/policy"
                        class="hover:text-primary transition-colors">Policies</a
                    >
                    <a
                        href="/portfolio"
                        class="hover:text-primary transition-colors"
                        >Portfolio</a
                    >
                    <a
                        href="/flash-designs"
                        class="hover:text-primary transition-colors"
                        >Flash Designs</a
                    >
                </div>
                <p>
                    &copy; {new Date().getFullYear()} Kow Tattys. All rights reserved.
                </p>
            </div>
        </footer>

        <!-- Global Booking Modal -->
        <BookingModal />

        <script>
            // Vanilla JS for Theme Toggle
            const handleToggleClick = () => {
                const element = document.documentElement;
                element.classList.toggle("dark");
                const isDark = element.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            };

            // Attach to both desktop and mobile toggle buttons
            ["theme-toggle", "theme-toggle-mobile"].forEach((id) => {
                document
                    .getElementById(id)
                    ?.addEventListener("click", handleToggleClick);
            });

            // Mobile Menu Toggle Logic
            const mobileMenuBtn = document.getElementById("mobile-menu-btn");
            const mobileMenuClose =
                document.getElementById("mobile-menu-close");
            const mobileMenu = document.getElementById("mobile-menu");
            const mobileMenuLinks = mobileMenu?.querySelectorAll(
                "a, button.booking-trigger",
            );

            const toggleMobileMenu = () => {
                const isOpen = mobileMenu?.classList.contains("opacity-100");

                if (!isOpen) {
                    mobileMenu?.classList.remove(
                        "opacity-0",
                        "pointer-events-none",
                        "-translate-y-full",
                    );
                    mobileMenu?.classList.add(
                        "opacity-100",
                        "pointer-events-auto",
                        "translate-y-0",
                    );
                    document.body.style.overflow = "hidden";
                } else {
                    mobileMenu?.classList.add(
                        "opacity-0",
                        "pointer-events-none",
                        "-translate-y-full",
                    );
                    mobileMenu?.classList.remove(
                        "opacity-100",
                        "pointer-events-auto",
                        "translate-y-0",
                    );
                    document.body.style.overflow = "";
                }
            };

            mobileMenuBtn?.addEventListener("click", (e) => {
                e.stopPropagation();
                toggleMobileMenu();
            });

            mobileMenuClose?.addEventListener("click", (e) => {
                e.stopPropagation();
                toggleMobileMenu();
            });

            // Close menu when clicking links
            mobileMenuLinks?.forEach((link) => {
                link.addEventListener("click", () => {
                    if (mobileMenu?.classList.contains("opacity-100")) {
                        toggleMobileMenu();
                    }
                });
            });

            // Close menu when clicking outside
            document.addEventListener("click", (e) => {
                const target = e.target;
                if (
                    target instanceof Node &&
                    mobileMenu?.classList.contains("opacity-100") &&
                    mobileMenu &&
                    !mobileMenu.contains(target) &&
                    mobileMenuBtn &&
                    !mobileMenuBtn.contains(target)
                ) {
                    toggleMobileMenu();
                }
            });

            // Booking Modal Triggers
            document.querySelectorAll(".booking-trigger").forEach((trigger) => {
                trigger.addEventListener("click", (e) => {
                    e.preventDefault();
                    // Dispatch custom event to open booking modal
                    window.dispatchEvent(new CustomEvent("openBookingModal"));
                });
            });
        </script>
    </body>
</html>
